!function e(t,n,r){function i(a,u){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!u&&l)return l(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[a]={exports:{}};t[a][0].call(f.exports,function(e){var n=t[a][1][e];return i(n?n:e)},f,f.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){(function(e){function n(){for(;i.next;){i=i.next;var e=i.task;i.task=void 0;var t=i.domain;t&&(i.domain=void 0,t.enter());try{e()}catch(r){if(l)throw t&&t.exit(),setTimeout(n,0),t&&t.enter(),r;setTimeout(function(){throw r},0)}t&&t.exit()}a=!1}function r(t){o=o.next={task:t,domain:l&&e.domain,next:null},a||(a=!0,u())}var i={task:void 0,next:null},o=i,a=!1,u=void 0,l=!1;if("undefined"!=typeof e&&e.nextTick)l=!0,u=function(){e.nextTick(n)};else if("function"==typeof setImmediate)u="undefined"!=typeof window?setImmediate.bind(window,n):function(){setImmediate(n)};else if("undefined"!=typeof MessageChannel){var c=new MessageChannel;c.port1.onmessage=n,u=function(){c.port2.postMessage(0)}}else u=function(){setTimeout(n,0)};t.exports=r}).call(this,e("_process"))},{_process:3}],2:[function(e,t,n){(function(e){(function(){function r(e,t,n){for(var r=(n||0)-1,i=e?e.length:0;++r<i;)if(e[r]===t)return r;return-1}function i(e,t){var n=typeof t;if(e=e.cache,"boolean"==n||null==t)return e[t]?0:-1;"number"!=n&&"string"!=n&&(n="object");var i="number"==n?t:w+t;return e=(e=e[n])&&e[i],"object"==n?e&&r(e,t)>-1?0:-1:e?0:-1}function o(e){var t=this.cache,n=typeof e;if("boolean"==n||null==e)t[e]=!0;else{"number"!=n&&"string"!=n&&(n="object");var r="number"==n?e:w+e,i=t[n]||(t[n]={});"object"==n?(i[r]||(i[r]=[])).push(e):i[r]=!0}}function a(e){return e.charCodeAt(0)}function u(e,t){for(var n=e.criteria,r=t.criteria,i=-1,o=n.length;++i<o;){var a=n[i],u=r[i];if(a!==u){if(a>u||"undefined"==typeof a)return 1;if(u>a||"undefined"==typeof u)return-1}}return e.index-t.index}function l(e){var t=-1,n=e.length,r=e[0],i=e[n/2|0],a=e[n-1];if(r&&"object"==typeof r&&i&&"object"==typeof i&&a&&"object"==typeof a)return!1;var u=s();u["false"]=u["null"]=u["true"]=u.undefined=!1;var l=s();for(l.array=e,l.cache=u,l.push=o;++t<n;)l.push(e[t]);return l}function c(e){return"\\"+J[e]}function f(){return g.pop()||[]}function s(){return y.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function d(e){e.length=0,g.length<M&&g.push(e)}function h(e){var t=e.cache;t&&h(t),e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null,y.length<M&&y.push(e)}function p(e,t,n){t||(t=0),"undefined"==typeof n&&(n=e?e.length:0);for(var r=-1,i=n-t||0,o=Array(0>i?0:i);++r<i;)o[r]=e[t+r];return o}function v(e){function t(e){return e&&"object"==typeof e&&!Zn(e)&&Ln.call(e,"__wrapped__")?e:new n(e)}function n(e,t){this.__chain__=!!t,this.__wrapped__=e}function o(e){function t(){if(r){var e=p(r);An.apply(e,arguments)}if(this instanceof t){var o=y(n.prototype),a=n.apply(o,e||arguments);return Se(a)?a:o}return n.apply(i,e||arguments)}var n=e[0],r=e[2],i=e[4];return Xn(t,e),t}function g(e,t,n,r,i){if(n){var o=n(e);if("undefined"!=typeof o)return o}var a=Se(e);if(!a)return e;var u=On.call(e);if(!$[u])return e;var l=Kn[u];switch(u){case F:case I:return new l(+e);case U:case B:return new l(e);case N:return o=l(e.source,k.exec(e)),o.lastIndex=e.lastIndex,o}var c=Zn(e);if(t){var s=!r;r||(r=f()),i||(i=f());for(var h=r.length;h--;)if(r[h]==e)return i[h];o=c?l(e.length):{}}else o=c?p(e):or({},e);return c&&(Ln.call(e,"index")&&(o.index=e.index),Ln.call(e,"input")&&(o.input=e.input)),t?(r.push(e),i.push(o),(c?Je:lr)(e,function(e,a){o[a]=g(e,t,n,r,i)}),s&&(d(r),d(i)),o):o}function y(e,t){return Se(e)?In(e):{}}function M(e,t,n){if("function"!=typeof e)return Xt;if("undefined"==typeof t||!("prototype"in e))return e;var r=e.__bindData__;if("undefined"==typeof r&&(Jn.funcNames&&(r=!e.name),r=r||!Jn.funcDecomp,!r)){var i=Cn.call(e);Jn.funcNames||(r=!P.test(i)),r||(r=H.test(i),Xn(e,r))}if(r===!1||r!==!0&&1&r[1])return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,o){return e.call(t,n,r,i,o)}}return Lt(e,t)}function J(e){function t(){var e=l?a:this;if(i){var h=p(i);An.apply(h,arguments)}if((o||f)&&(h||(h=p(arguments)),o&&An.apply(h,o),f&&h.length<u))return r|=16,J([n,s?r:-4&r,h,null,a,u]);if(h||(h=arguments),c&&(n=e[d]),this instanceof t){e=y(n.prototype);var v=n.apply(e,h);return Se(v)?v:e}return n.apply(e,h)}var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],u=e[5],l=1&r,c=2&r,f=4&r,s=8&r,d=n;return Xn(t,e),t}function Z(e,t){var n=-1,o=le(),a=e?e.length:0,u=a>=_&&o===r,c=[];if(u){var f=l(t);f?(o=i,t=f):u=!1}for(;++n<a;){var s=e[n];o(t,s)<0&&c.push(s)}return u&&h(t),c}function Q(e,t,n,r){for(var i=(r||0)-1,o=e?e.length:0,a=[];++i<o;){var u=e[i];if(u&&"object"==typeof u&&"number"==typeof u.length&&(Zn(u)||de(u))){t||(u=Q(u,t,n));var l=-1,c=u.length,f=a.length;for(a.length+=c;++l<c;)a[f++]=u[l]}else n||a.push(u)}return a}function ee(e,t,n,r,i,o){if(n){var a=n(e,t);if("undefined"!=typeof a)return!!a}if(e===t)return 0!==e||1/e==1/t;var u=typeof e,l=typeof t;if(!(e!==e||e&&K[u]||t&&K[l]))return!1;if(null==e||null==t)return e===t;var c=On.call(e),s=On.call(t);if(c==z&&(c=W),s==z&&(s=W),c!=s)return!1;switch(c){case F:case I:return+e==+t;case U:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case N:case B:return e==Mn(t)}var h=c==q;if(!h){var p=Ln.call(e,"__wrapped__"),v=Ln.call(t,"__wrapped__");if(p||v)return ee(p?e.__wrapped__:e,v?t.__wrapped__:t,n,r,i,o);if(c!=W)return!1;var m=e.constructor,g=t.constructor;if(m!=g&&!(Pe(m)&&m instanceof m&&Pe(g)&&g instanceof g)&&"constructor"in e&&"constructor"in t)return!1}var y=!i;i||(i=f()),o||(o=f());for(var b=i.length;b--;)if(i[b]==e)return o[b]==t;var w=0;if(a=!0,i.push(e),o.push(t),h){if(b=e.length,w=t.length,a=w==b,a||r)for(;w--;){var _=b,M=t[w];if(r)for(;_--&&!(a=ee(e[_],M,n,r,i,o)););else if(!(a=ee(e[w],M,n,r,i,o)))break}}else ur(t,function(t,u,l){return Ln.call(l,u)?(w++,a=Ln.call(e,u)&&ee(e[u],t,n,r,i,o)):void 0}),a&&!r&&ur(e,function(e,t,n){return Ln.call(n,t)?a=--w>-1:void 0});return i.pop(),o.pop(),y&&(d(i),d(o)),a}function te(e,t,n,r,i){(Zn(t)?Je:lr)(t,function(t,o){var a,u,l=t,c=e[o];if(t&&((u=Zn(t))||cr(t))){for(var f=r.length;f--;)if(a=r[f]==t){c=i[f];break}if(!a){var s;n&&(l=n(c,t),(s="undefined"!=typeof l)&&(c=l)),s||(c=u?Zn(c)?c:[]:cr(c)?c:{}),r.push(t),i.push(c),s||te(c,t,n,r,i)}}else n&&(l=n(c,t),"undefined"==typeof l&&(l=t)),"undefined"!=typeof l&&(c=l);e[o]=c})}function re(e,t){return e+Rn(Yn()*(t-e+1))}function ie(e,t,n){var o=-1,a=le(),u=e?e.length:0,c=[],s=!t&&u>=_&&a===r,p=n||s?f():c;if(s){var v=l(p);a=i,p=v}for(;++o<u;){var m=e[o],g=n?n(m,o,e):m;(t?!o||p[p.length-1]!==g:a(p,g)<0)&&((n||s)&&p.push(g),c.push(m))}return s?(d(p.array),h(p)):n&&d(p),c}function oe(e){return function(n,r,i){var o={};r=t.createCallback(r,i,3);var a=-1,u=n?n.length:0;if("number"==typeof u)for(;++a<u;){var l=n[a];e(o,l,r(l,a,n),n)}else lr(n,function(t,n,i){e(o,t,r(t,n,i),i)});return o}}function ae(e,t,n,r,i,a){var u=1&t,l=2&t,c=4&t,f=16&t,s=32&t;if(!l&&!Pe(e))throw new Tn;f&&!n.length&&(t&=-17,f=n=!1),s&&!r.length&&(t&=-33,s=r=!1);var d=e&&e.__bindData__;if(d&&d!==!0)return d=p(d),d[2]&&(d[2]=p(d[2])),d[3]&&(d[3]=p(d[3])),!u||1&d[1]||(d[4]=i),!u&&1&d[1]&&(t|=8),!c||4&d[1]||(d[5]=a),f&&An.apply(d[2]||(d[2]=[]),n),s&&qn.apply(d[3]||(d[3]=[]),r),d[1]|=t,ae.apply(null,d);var h=1==t||17===t?o:J;return h([e,t,n,r,i,a])}function ue(e){return tr[e]}function le(){var e=(e=t.indexOf)===gt?r:e;return e}function ce(e){return"function"==typeof e&&kn.test(e)}function fe(e){var t,n;return e&&On.call(e)==W&&(t=e.constructor,!Pe(t)||t instanceof t)?(ur(e,function(e,t){n=t}),"undefined"==typeof n||Ln.call(e,n)):!1}function se(e){return nr[e]}function de(e){return e&&"object"==typeof e&&"number"==typeof e.length&&On.call(e)==z||!1}function he(e,t,n,r){return"boolean"!=typeof t&&null!=t&&(r=n,n=t,t=!1),g(e,t,"function"==typeof n&&M(n,r,1))}function pe(e,t,n){return g(e,!0,"function"==typeof t&&M(t,n,1))}function ve(e,t){var n=y(e);return t?or(n,t):n}function me(e,n,r){var i;return n=t.createCallback(n,r,3),lr(e,function(e,t,r){return n(e,t,r)?(i=t,!1):void 0}),i}function ge(e,n,r){var i;return n=t.createCallback(n,r,3),be(e,function(e,t,r){return n(e,t,r)?(i=t,!1):void 0}),i}function ye(e,t,n){var r=[];ur(e,function(e,t){r.push(t,e)});var i=r.length;for(t=M(t,n,3);i--&&t(r[i--],r[i],e)!==!1;);return e}function be(e,t,n){var r=er(e),i=r.length;for(t=M(t,n,3);i--;){var o=r[i];if(t(e[o],o,e)===!1)break}return e}function we(e){var t=[];return ur(e,function(e,n){Pe(e)&&t.push(n)}),t.sort()}function _e(e,t){return e?Ln.call(e,t):!1}function Me(e){for(var t=-1,n=er(e),r=n.length,i={};++t<r;){var o=n[t];i[e[o]]=o}return i}function Te(e){return e===!0||e===!1||e&&"object"==typeof e&&On.call(e)==F||!1}function Ee(e){return e&&"object"==typeof e&&On.call(e)==I||!1}function xe(e){return e&&1===e.nodeType||!1}function je(e){var t=!0;if(!e)return t;var n=On.call(e),r=e.length;return n==q||n==B||n==z||n==W&&"number"==typeof r&&Pe(e.splice)?!r:(lr(e,function(){return t=!1}),t)}function Oe(e,t,n,r){return ee(e,t,"function"==typeof n&&M(n,r,2))}function ke(e){return Un(e)&&!Wn(parseFloat(e))}function Pe(e){return"function"==typeof e}function Se(e){return!(!e||!K[typeof e])}function Re(e){return He(e)&&e!=+e}function Ce(e){return null===e}function He(e){return"number"==typeof e||e&&"object"==typeof e&&On.call(e)==U||!1}function Le(e){return e&&"object"==typeof e&&On.call(e)==N||!1}function Ae(e){return"string"==typeof e||e&&"object"==typeof e&&On.call(e)==B||!1}function De(e){return"undefined"==typeof e}function ze(e,n,r){var i={};return n=t.createCallback(n,r,3),lr(e,function(e,t,r){i[t]=n(e,t,r)}),i}function qe(e){var t=arguments,n=2;if(!Se(e))return e;if("number"!=typeof t[2]&&(n=t.length),n>3&&"function"==typeof t[n-2])var r=M(t[--n-1],t[n--],2);else n>2&&"function"==typeof t[n-1]&&(r=t[--n]);for(var i=p(arguments,1,n),o=-1,a=f(),u=f();++o<n;)te(e,i[o],r,a,u);return d(a),d(u),e}function Fe(e,n,r){var i={};if("function"!=typeof n){var o=[];ur(e,function(e,t){o.push(t)}),o=Z(o,Q(arguments,!0,!1,1));for(var a=-1,u=o.length;++a<u;){var l=o[a];i[l]=e[l]}}else n=t.createCallback(n,r,3),ur(e,function(e,t,r){n(e,t,r)||(i[t]=e)});return i}function Ie(e){for(var t=-1,n=er(e),r=n.length,i=pn(r);++t<r;){var o=n[t];i[t]=[o,e[o]]}return i}function Ge(e,n,r){var i={};if("function"!=typeof n)for(var o=-1,a=Q(arguments,!0,!1,1),u=Se(e)?a.length:0;++o<u;){var l=a[o];l in e&&(i[l]=e[l])}else n=t.createCallback(n,r,3),ur(e,function(e,t,r){n(e,t,r)&&(i[t]=e)});return i}function Ue(e,n,r,i){var o=Zn(e);if(null==r)if(o)r=[];else{var a=e&&e.constructor,u=a&&a.prototype;r=y(u)}return n&&(n=t.createCallback(n,i,4),(o?Je:lr)(e,function(e,t,i){return n(r,e,t,i)})),r}function We(e){for(var t=-1,n=er(e),r=n.length,i=pn(r);++t<r;)i[t]=e[n[t]];return i}function Ne(e){for(var t=arguments,n=-1,r=Q(t,!0,!1,1),i=t[2]&&t[2][t[1]]===e?1:r.length,o=pn(i);++n<i;)o[n]=e[r[n]];return o}function Be(e,t,n){var r=-1,i=le(),o=e?e.length:0,a=!1;return n=(0>n?Bn(0,o+n):n)||0,Zn(e)?a=i(e,t,n)>-1:"number"==typeof o?a=(Ae(e)?e.indexOf(t,n):i(e,t,n))>-1:lr(e,function(e){return++r>=n?!(a=e===t):void 0}),a}function $e(e,n,r){var i=!0;n=t.createCallback(n,r,3);var o=-1,a=e?e.length:0;if("number"==typeof a)for(;++o<a&&(i=!!n(e[o],o,e)););else lr(e,function(e,t,r){return i=!!n(e,t,r)});return i}function Ve(e,n,r){var i=[];n=t.createCallback(n,r,3);var o=-1,a=e?e.length:0;if("number"==typeof a)for(;++o<a;){var u=e[o];n(u,o,e)&&i.push(u)}else lr(e,function(e,t,r){n(e,t,r)&&i.push(e)});return i}function Ye(e,n,r){n=t.createCallback(n,r,3);var i=-1,o=e?e.length:0;if("number"!=typeof o){var a;return lr(e,function(e,t,r){return n(e,t,r)?(a=e,!1):void 0}),a}for(;++i<o;){var u=e[i];if(n(u,i,e))return u}}function Ke(e,n,r){var i;return n=t.createCallback(n,r,3),Xe(e,function(e,t,r){return n(e,t,r)?(i=e,!1):void 0}),i}function Je(e,t,n){var r=-1,i=e?e.length:0;if(t=t&&"undefined"==typeof n?t:M(t,n,3),"number"==typeof i)for(;++r<i&&t(e[r],r,e)!==!1;);else lr(e,t);return e}function Xe(e,t,n){var r=e?e.length:0;if(t=t&&"undefined"==typeof n?t:M(t,n,3),"number"==typeof r)for(;r--&&t(e[r],r,e)!==!1;);else{var i=er(e);r=i.length,lr(e,function(e,n,o){return n=i?i[--r]:--r,t(o[n],n,o)})}return e}function Ze(e,t){var n=p(arguments,2),r=-1,i="function"==typeof t,o=e?e.length:0,a=pn("number"==typeof o?o:0);return Je(e,function(e){a[++r]=(i?t:e[t]).apply(e,n)}),a}function Qe(e,n,r){var i=-1,o=e?e.length:0;if(n=t.createCallback(n,r,3),"number"==typeof o)for(var a=pn(o);++i<o;)a[i]=n(e[i],i,e);else a=[],lr(e,function(e,t,r){a[++i]=n(e,t,r)});return a}function et(e,n,r){var i=-(1/0),o=i;if("function"!=typeof n&&r&&r[n]===e&&(n=null),null==n&&Zn(e))for(var u=-1,l=e.length;++u<l;){var c=e[u];c>o&&(o=c)}else n=null==n&&Ae(e)?a:t.createCallback(n,r,3),Je(e,function(e,t,r){var a=n(e,t,r);a>i&&(i=a,o=e)});return o}function tt(e,n,r){var i=1/0,o=i;if("function"!=typeof n&&r&&r[n]===e&&(n=null),null==n&&Zn(e))for(var u=-1,l=e.length;++u<l;){var c=e[u];o>c&&(o=c)}else n=null==n&&Ae(e)?a:t.createCallback(n,r,3),Je(e,function(e,t,r){var a=n(e,t,r);i>a&&(i=a,o=e)});return o}function nt(e,n,r,i){if(!e)return r;var o=arguments.length<3;n=t.createCallback(n,i,4);var a=-1,u=e.length;if("number"==typeof u)for(o&&(r=e[++a]);++a<u;)r=n(r,e[a],a,e);else lr(e,function(e,t,i){r=o?(o=!1,e):n(r,e,t,i)});return r}function rt(e,n,r,i){var o=arguments.length<3;return n=t.createCallback(n,i,4),Xe(e,function(e,t,i){r=o?(o=!1,e):n(r,e,t,i)}),r}function it(e,n,r){return n=t.createCallback(n,r,3),Ve(e,function(e,t,r){return!n(e,t,r)})}function ot(e,t,n){if(e&&"number"!=typeof e.length&&(e=We(e)),null==t||n)return e?e[re(0,e.length-1)]:m;var r=at(e);return r.length=$n(Bn(0,t),r.length),r}function at(e){var t=-1,n=e?e.length:0,r=pn("number"==typeof n?n:0);return Je(e,function(e){var n=re(0,++t);r[t]=r[n],r[n]=e}),r}function ut(e){var t=e?e.length:0;return"number"==typeof t?t:er(e).length}function lt(e,n,r){var i;n=t.createCallback(n,r,3);var o=-1,a=e?e.length:0;if("number"==typeof a)for(;++o<a&&!(i=n(e[o],o,e)););else lr(e,function(e,t,r){return!(i=n(e,t,r))});return!!i}function ct(e,n,r){var i=-1,o=Zn(n),a=e?e.length:0,l=pn("number"==typeof a?a:0);for(o||(n=t.createCallback(n,r,3)),Je(e,function(e,t,r){var a=l[++i]=s();o?a.criteria=Qe(n,function(t){return e[t]}):(a.criteria=f())[0]=n(e,t,r),a.index=i,a.value=e}),a=l.length,l.sort(u);a--;){var c=l[a];l[a]=c.value,o||d(c.criteria),h(c)}return l}function ft(e){return e&&"number"==typeof e.length?p(e):We(e)}function st(e){for(var t=-1,n=e?e.length:0,r=[];++t<n;){var i=e[t];i&&r.push(i)}return r}function dt(e){return Z(e,Q(arguments,!0,!0,1))}function ht(e,n,r){var i=-1,o=e?e.length:0;for(n=t.createCallback(n,r,3);++i<o;)if(n(e[i],i,e))return i;return-1}function pt(e,n,r){var i=e?e.length:0;for(n=t.createCallback(n,r,3);i--;)if(n(e[i],i,e))return i;return-1}function vt(e,n,r){var i=0,o=e?e.length:0;if("number"!=typeof n&&null!=n){var a=-1;for(n=t.createCallback(n,r,3);++a<o&&n(e[a],a,e);)i++}else if(i=n,null==i||r)return e?e[0]:m;return p(e,0,$n(Bn(0,i),o))}function mt(e,t,n,r){return"boolean"!=typeof t&&null!=t&&(r=n,n="function"!=typeof t&&r&&r[t]===e?null:t,t=!1),null!=n&&(e=Qe(e,n,r)),Q(e,t)}function gt(e,t,n){if("number"==typeof n){var i=e?e.length:0;n=0>n?Bn(0,i+n):n||0}else if(n){var o=jt(e,t);return e[o]===t?o:-1}return r(e,t,n)}function yt(e,n,r){var i=0,o=e?e.length:0;if("number"!=typeof n&&null!=n){var a=o;for(n=t.createCallback(n,r,3);a--&&n(e[a],a,e);)i++}else i=null==n||r?1:n||i;return p(e,0,$n(Bn(0,o-i),o))}function bt(){for(var e=[],t=-1,n=arguments.length,o=f(),a=le(),u=a===r,c=f();++t<n;){var s=arguments[t];(Zn(s)||de(s))&&(e.push(s),o.push(u&&s.length>=_&&l(t?e[t]:c)))}var p=e[0],v=-1,m=p?p.length:0,g=[];e:for(;++v<m;){var y=o[0];if(s=p[v],(y?i(y,s):a(c,s))<0){for(t=n,(y||c).push(s);--t;)if(y=o[t],(y?i(y,s):a(e[t],s))<0)continue e;g.push(s)}}for(;n--;)y=o[n],y&&h(y);return d(o),d(c),g}function wt(e,n,r){var i=0,o=e?e.length:0;if("number"!=typeof n&&null!=n){var a=o;for(n=t.createCallback(n,r,3);a--&&n(e[a],a,e);)i++}else if(i=n,null==i||r)return e?e[o-1]:m;return p(e,Bn(0,o-i))}function _t(e,t,n){var r=e?e.length:0;for("number"==typeof n&&(r=(0>n?Bn(0,r+n):$n(n,r-1))+1);r--;)if(e[r]===t)return r;return-1}function Mt(e){for(var t=arguments,n=0,r=t.length,i=e?e.length:0;++n<r;)for(var o=-1,a=t[n];++o<i;)e[o]===a&&(zn.call(e,o--,1),i--);return e}function Tt(e,t,n){e=+e||0,n="number"==typeof n?n:+n||1,null==t&&(t=e,e=0);for(var r=-1,i=Bn(0,Pn((t-e)/(n||1))),o=pn(i);++r<i;)o[r]=e,e+=n;return o}function Et(e,n,r){var i=-1,o=e?e.length:0,a=[];for(n=t.createCallback(n,r,3);++i<o;){var u=e[i];n(u,i,e)&&(a.push(u),zn.call(e,i--,1),o--)}return a}function xt(e,n,r){if("number"!=typeof n&&null!=n){var i=0,o=-1,a=e?e.length:0;for(n=t.createCallback(n,r,3);++o<a&&n(e[o],o,e);)i++}else i=null==n||r?1:Bn(0,n);return p(e,i)}function jt(e,n,r,i){var o=0,a=e?e.length:o;for(r=r?t.createCallback(r,i,1):Xt,n=r(n);a>o;){var u=o+a>>>1;r(e[u])<n?o=u+1:a=u}return o}function Ot(){return ie(Q(arguments,!0,!0))}function kt(e,n,r,i){return"boolean"!=typeof n&&null!=n&&(i=r,r="function"!=typeof n&&i&&i[n]===e?null:n,n=!1),null!=r&&(r=t.createCallback(r,i,3)),ie(e,n,r)}function Pt(e){return Z(e,p(arguments,1))}function St(){for(var e=-1,t=arguments.length;++e<t;){var n=arguments[e];if(Zn(n)||de(n))var r=r?ie(Z(r,n).concat(Z(n,r))):n}return r||[]}function Rt(){for(var e=arguments.length>1?arguments:arguments[0],t=-1,n=e?et(hr(e,"length")):0,r=pn(0>n?0:n);++t<n;)r[t]=hr(e,t);return r}function Ct(e,t){var n=-1,r=e?e.length:0,i={};for(t||!r||Zn(e[0])||(t=[]);++n<r;){var o=e[n];t?i[o]=t[n]:o&&(i[o[0]]=o[1])}return i}function Ht(e,t){if(!Pe(t))throw new Tn;return function(){return--e<1?t.apply(this,arguments):void 0}}function Lt(e,t){return arguments.length>2?ae(e,17,p(arguments,2),null,t):ae(e,1,null,null,t)}function At(e){for(var t=arguments.length>1?Q(arguments,!0,!1,1):we(e),n=-1,r=t.length;++n<r;){var i=t[n];e[i]=ae(e[i],1,null,null,e)}return e}function Dt(e,t){return arguments.length>2?ae(t,19,p(arguments,2),null,e):ae(t,3,null,null,e)}function zt(){for(var e=arguments,t=e.length;t--;)if(!Pe(e[t]))throw new Tn;return function(){for(var t=arguments,n=e.length;n--;)t=[e[n].apply(this,t)];return t[0]}}function qt(e,t){return t="number"==typeof t?t:+t||e.length,ae(e,4,null,null,null,t)}function Ft(e,t,n){var r,i,o,a,u,l,c,f=0,s=!1,d=!0;if(!Pe(e))throw new Tn;if(t=Bn(0,t)||0,n===!0){var h=!0;d=!1}else Se(n)&&(h=n.leading,s="maxWait"in n&&(Bn(t,n.maxWait)||0),d="trailing"in n?n.trailing:d);var p=function(){var n=t-(vr()-a);if(0>=n){i&&Sn(i);var s=c;i=l=c=m,s&&(f=vr(),o=e.apply(u,r),l||i||(r=u=null))}else l=Dn(p,n)},v=function(){l&&Sn(l),i=l=c=m,(d||s!==t)&&(f=vr(),o=e.apply(u,r),l||i||(r=u=null))};return function(){if(r=arguments,a=vr(),u=this,c=d&&(l||!h),s===!1)var n=h&&!l;else{i||h||(f=a);var m=s-(a-f),g=0>=m;g?(i&&(i=Sn(i)),f=a,o=e.apply(u,r)):i||(i=Dn(v,m))}return g&&l?l=Sn(l):l||t===s||(l=Dn(p,t)),n&&(g=!0,o=e.apply(u,r)),!g||l||i||(r=u=null),o}}function It(e){if(!Pe(e))throw new Tn;var t=p(arguments,1);return Dn(function(){e.apply(m,t)},1)}function Gt(e,t){if(!Pe(e))throw new Tn;var n=p(arguments,2);return Dn(function(){e.apply(m,n)},t)}function Ut(e,t){if(!Pe(e))throw new Tn;var n=function(){var r=n.cache,i=t?t.apply(this,arguments):w+arguments[0];return Ln.call(r,i)?r[i]:r[i]=e.apply(this,arguments)};return n.cache={},n}function Wt(e){var t,n;if(!Pe(e))throw new Tn;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}}function Nt(e){return ae(e,16,p(arguments,1))}function Bt(e){return ae(e,32,null,p(arguments,1))}function $t(e,t,n){var r=!0,i=!0;if(!Pe(e))throw new Tn;return n===!1?r=!1:Se(n)&&(r="leading"in n?n.leading:r,i="trailing"in n?n.trailing:i),V.leading=r,V.maxWait=t,V.trailing=i,Ft(e,t,V)}function Vt(e,t){return ae(t,16,[e])}function Yt(e){return function(){return e}}function Kt(e,t,n){var r=typeof e;if(null==e||"function"==r)return M(e,t,n);if("object"!=r)return tn(e);var i=er(e),o=i[0],a=e[o];return 1!=i.length||a!==a||Se(a)?function(t){for(var n=i.length,r=!1;n--&&(r=ee(t[i[n]],e[i[n]],null,!0)););return r}:function(e){var t=e[o];return a===t&&(0!==a||1/a==1/t)}}function Jt(e){return null==e?"":Mn(e).replace(ir,ue)}function Xt(e){return e}function Zt(e,r,i){var o=!0,a=r&&we(r);r&&(i||a.length)||(null==i&&(i=r),u=n,r=e,e=t,a=we(r)),i===!1?o=!1:Se(i)&&"chain"in i&&(o=i.chain);var u=e,l=Pe(u);Je(a,function(t){var n=e[t]=r[t];l&&(u.prototype[t]=function(){var t=this.__chain__,r=this.__wrapped__,i=[r];An.apply(i,arguments);var a=n.apply(e,i);if(o||t){if(r===a&&Se(a))return this;a=new u(a),a.__chain__=t}return a})})}function Qt(){return e._=jn,this}function en(){}function tn(e){return function(t){return t[e]}}function nn(e,t,n){var r=null==e,i=null==t;if(null==n&&("boolean"==typeof e&&i?(n=e,e=1):i||"boolean"!=typeof t||(n=t,i=!0)),r&&i&&(t=1),e=+e||0,i?(t=e,e=0):t=+t||0,n||e%1||t%1){var o=Yn();return $n(e+o*(t-e+parseFloat("1e-"+((o+"").length-1))),t)}return re(e,t)}function rn(e,t){if(e){var n=e[t];return Pe(n)?e[t]():n}}function on(e,n,r){var i=t.templateSettings;e=Mn(e||""),r=ar({},r,i);var o,a=ar({},r.imports,i.imports),u=er(a),l=We(a),f=0,s=r.interpolate||C,d="__p += '",h=_n((r.escape||C).source+"|"+s.source+"|"+(s===S?O:C).source+"|"+(r.evaluate||C).source+"|$","g");e.replace(h,function(t,n,r,i,a,u){return r||(r=i),d+=e.slice(f,u).replace(L,c),n&&(d+="' +\n__e("+n+") +\n'"),a&&(o=!0,d+="';\n"+a+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),f=u+t.length,t}),d+="';\n";var p=r.variable,v=p;v||(p="obj",d="with ("+p+") {\n"+d+"\n}\n"),d=(o?d.replace(E,""):d).replace(x,"$1").replace(j,"$1;"),d="function("+p+") {\n"+(v?"":p+" || ("+p+" = {});\n")+"var __t, __p = '', __e = _.escape"+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g="\n/*\n//# sourceURL="+(r.sourceURL||"/lodash/template/source["+D++ +"]")+"\n*/";try{var y=gn(u,"return "+d+g).apply(m,l)}catch(b){throw b.source=d,b}return n?y(n):(y.source=d,y)}function an(e,t,n){e=(e=+e)>-1?e:0;var r=-1,i=pn(e);for(t=M(t,n,1);++r<e;)i[r]=t(r);return i}function un(e){return null==e?"":Mn(e).replace(rr,se)}function ln(e){var t=++b;return Mn(null==e?"":e)+t}function cn(e){return e=new n(e),e.__chain__=!0,e}function fn(e,t){return t(e),e}function sn(){return this.__chain__=!0,this}function dn(){return Mn(this.__wrapped__)}function hn(){return this.__wrapped__}e=e?ne.defaults(X.Object(),e,ne.pick(X,A)):X;var pn=e.Array,vn=e.Boolean,mn=e.Date,gn=e.Function,yn=e.Math,bn=e.Number,wn=e.Object,_n=e.RegExp,Mn=e.String,Tn=e.TypeError,En=[],xn=wn.prototype,jn=e._,On=xn.toString,kn=_n("^"+Mn(On).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Pn=yn.ceil,Sn=e.clearTimeout,Rn=yn.floor,Cn=gn.prototype.toString,Hn=ce(Hn=wn.getPrototypeOf)&&Hn,Ln=xn.hasOwnProperty,An=En.push,Dn=e.setTimeout,zn=En.splice,qn=En.unshift,Fn=function(){try{var e={},t=ce(t=wn.defineProperty)&&t,n=t(e,e,e)&&t}catch(r){}return n}(),In=ce(In=wn.create)&&In,Gn=ce(Gn=pn.isArray)&&Gn,Un=e.isFinite,Wn=e.isNaN,Nn=ce(Nn=wn.keys)&&Nn,Bn=yn.max,$n=yn.min,Vn=e.parseInt,Yn=yn.random,Kn={};Kn[q]=pn,Kn[F]=vn,Kn[I]=mn,Kn[G]=gn,Kn[W]=wn,Kn[U]=bn,Kn[N]=_n,Kn[B]=Mn,n.prototype=t.prototype;var Jn=t.support={};Jn.funcDecomp=!ce(e.WinRTError)&&H.test(v),Jn.funcNames="string"==typeof gn.name,t.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:S,variable:"",imports:{_:t}},In||(y=function(){function t(){}return function(n){if(Se(n)){t.prototype=n;var r=new t;t.prototype=null}return r||e.Object()}}());var Xn=Fn?function(e,t){Y.value=t,Fn(e,"__bindData__",Y),Y.value=null}:en,Zn=Gn||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&On.call(e)==q||!1},Qn=function(e){var t,n=e,r=[];if(!n)return r;if(!K[typeof e])return r;for(t in n)Ln.call(n,t)&&r.push(t);return r},er=Nn?function(e){return Se(e)?Nn(e):[]}:Qn,tr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},nr=Me(tr),rr=_n("("+er(nr).join("|")+")","g"),ir=_n("["+er(tr).join("")+"]","g"),or=function(e,t,n){var r,i=e,o=i;if(!i)return o;var a=arguments,u=0,l="number"==typeof n?2:a.length;if(l>3&&"function"==typeof a[l-2])var c=M(a[--l-1],a[l--],2);else l>2&&"function"==typeof a[l-1]&&(c=a[--l]);for(;++u<l;)if(i=a[u],i&&K[typeof i])for(var f=-1,s=K[typeof i]&&er(i),d=s?s.length:0;++f<d;)r=s[f],o[r]=c?c(o[r],i[r]):i[r];return o},ar=function(e,t,n){var r,i=e,o=i;if(!i)return o;for(var a=arguments,u=0,l="number"==typeof n?2:a.length;++u<l;)if(i=a[u],i&&K[typeof i])for(var c=-1,f=K[typeof i]&&er(i),s=f?f.length:0;++c<s;)r=f[c],"undefined"==typeof o[r]&&(o[r]=i[r]);return o},ur=function(e,t,n){var r,i=e,o=i;if(!i)return o;if(!K[typeof i])return o;t=t&&"undefined"==typeof n?t:M(t,n,3);for(r in i)if(t(i[r],r,e)===!1)return o;return o},lr=function(e,t,n){var r,i=e,o=i;if(!i)return o;if(!K[typeof i])return o;t=t&&"undefined"==typeof n?t:M(t,n,3);for(var a=-1,u=K[typeof i]&&er(i),l=u?u.length:0;++a<l;)if(r=u[a],t(i[r],r,e)===!1)return o;return o},cr=Hn?function(e){if(!e||On.call(e)!=W)return!1;var t=e.valueOf,n=ce(t)&&(n=Hn(t))&&Hn(n);return n?e==n||Hn(e)==n:fe(e)}:fe,fr=oe(function(e,t,n){Ln.call(e,n)?e[n]++:e[n]=1}),sr=oe(function(e,t,n){(Ln.call(e,n)?e[n]:e[n]=[]).push(t)}),dr=oe(function(e,t,n){e[n]=t}),hr=Qe,pr=Ve,vr=ce(vr=mn.now)&&vr||function(){return(new mn).getTime()},mr=8==Vn(T+"08")?Vn:function(e,t){return Vn(Ae(e)?e.replace(R,""):e,t||0)};return t.after=Ht,t.assign=or,t.at=Ne,t.bind=Lt,t.bindAll=At,t.bindKey=Dt,t.chain=cn,t.compact=st,t.compose=zt,t.constant=Yt,t.countBy=fr,t.create=ve,t.createCallback=Kt,t.curry=qt,t.debounce=Ft,t.defaults=ar,t.defer=It,t.delay=Gt,t.difference=dt,t.filter=Ve,t.flatten=mt,t.forEach=Je,t.forEachRight=Xe,t.forIn=ur,t.forInRight=ye,t.forOwn=lr,t.forOwnRight=be,t.functions=we,t.groupBy=sr,t.indexBy=dr,t.initial=yt,t.intersection=bt,t.invert=Me,t.invoke=Ze,t.keys=er,t.map=Qe,t.mapValues=ze,t.max=et,t.memoize=Ut,t.merge=qe,t.min=tt,t.omit=Fe,t.once=Wt,t.pairs=Ie,t.partial=Nt,t.partialRight=Bt,t.pick=Ge,t.pluck=hr,t.property=tn,t.pull=Mt,t.range=Tt,t.reject=it,t.remove=Et,t.rest=xt,t.shuffle=at,t.sortBy=ct,t.tap=fn,t.throttle=$t,t.times=an,t.toArray=ft,t.transform=Ue,t.union=Ot,t.uniq=kt,t.values=We,t.where=pr,t.without=Pt,t.wrap=Vt,t.xor=St,t.zip=Rt,t.zipObject=Ct,t.collect=Qe,t.drop=xt,t.each=Je,t.eachRight=Xe,t.extend=or,t.methods=we,t.object=Ct,t.select=Ve,t.tail=xt,t.unique=kt,t.unzip=Rt,Zt(t),t.clone=he,t.cloneDeep=pe,t.contains=Be,t.escape=Jt,t.every=$e,t.find=Ye,t.findIndex=ht,t.findKey=me,t.findLast=Ke,t.findLastIndex=pt,t.findLastKey=ge,t.has=_e,t.identity=Xt,t.indexOf=gt,t.isArguments=de,t.isArray=Zn,t.isBoolean=Te,t.isDate=Ee,t.isElement=xe,t.isEmpty=je,t.isEqual=Oe,t.isFinite=ke,t.isFunction=Pe,t.isNaN=Re,t.isNull=Ce,t.isNumber=He,t.isObject=Se,t.isPlainObject=cr,t.isRegExp=Le,t.isString=Ae,t.isUndefined=De,t.lastIndexOf=_t,t.mixin=Zt,t.noConflict=Qt,t.noop=en,t.now=vr,t.parseInt=mr,t.random=nn,t.reduce=nt,t.reduceRight=rt,t.result=rn,t.runInContext=v,t.size=ut,t.some=lt,t.sortedIndex=jt,t.template=on,t.unescape=un,t.uniqueId=ln,t.all=$e,t.any=lt,t.detect=Ye,t.findWhere=Ye,t.foldl=nt,t.foldr=rt,t.include=Be,t.inject=nt,Zt(function(){var e={};return lr(t,function(n,r){t.prototype[r]||(e[r]=n)}),e}(),!1),t.first=vt,t.last=wt,t.sample=ot,t.take=vt,t.head=vt,lr(t,function(e,r){var i="sample"!==r;t.prototype[r]||(t.prototype[r]=function(t,r){var o=this.__chain__,a=e(this.__wrapped__,t,r);return o||null!=t&&(!r||i&&"function"==typeof t)?new n(a,o):a})}),t.VERSION="2.4.2",t.prototype.chain=sn,t.prototype.toString=dn,t.prototype.value=hn,t.prototype.valueOf=hn,Je(["join","pop","shift"],function(e){var r=En[e];t.prototype[e]=function(){var e=this.__chain__,t=r.apply(this.__wrapped__,arguments);return e?new n(t,e):t}}),Je(["push","reverse","sort","unshift"],function(e){var n=En[e];t.prototype[e]=function(){return n.apply(this.__wrapped__,arguments),this}}),Je(["concat","slice","splice"],function(e){var r=En[e];t.prototype[e]=function(){return new n(r.apply(this.__wrapped__,arguments),this.__chain__)}}),t}var m,g=[],y=[],b=0,w=+new Date+"",_=75,M=40,T=" 	\x0B\f \ufeff\n\r\u2028\u2029 ᠎             　",E=/\b__p \+= '';/g,x=/\b(__p \+=) '' \+/g,j=/(__e\(.*?\)|\b__t\)) \+\n'';/g,O=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,k=/\w*$/,P=/^\s*function[ \n\r\t]+\w/,S=/<%=([\s\S]+?)%>/g,R=RegExp("^["+T+"]*0+(?=.$)"),C=/($^)/,H=/\bthis\b/,L=/['\n\r\t\u2028\u2029\\]/g,A=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],D=0,z="[object Arguments]",q="[object Array]",F="[object Boolean]",I="[object Date]",G="[object Function]",U="[object Number]",W="[object Object]",N="[object RegExp]",B="[object String]",$={};$[G]=!1,$[z]=$[q]=$[F]=$[I]=$[U]=$[W]=$[N]=$[B]=!0;var V={leading:!1,maxWait:0,trailing:!1},Y={configurable:!1,enumerable:!1,value:null,writable:!1},K={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},J={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},X=K[typeof window]&&window||this,Z=K[typeof n]&&n&&!n.nodeType&&n,Q=K[typeof t]&&t&&!t.nodeType&&t,ee=Q&&Q.exports===Z&&Z,te=K[typeof e]&&e;!te||te.global!==te&&te.window!==te||(X=te);var ne=v();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(X._=ne,define(function(){return ne})):Z&&Q?ee?(Q.exports=ne)._=ne:Z._=ne:X._=ne}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,n){function r(){f=!1,u.length?c=u.concat(c):s=-1,c.length&&i()}function i(){if(!f){var e=setTimeout(r);f=!0;for(var t=c.length;t;){for(u=c,c=[];++s<t;)u&&u[s].run();s=-1,t=c.length}u=null,f=!1,clearTimeout(e)}}function o(e,t){this.fun=e,this.array=t}function a(){}var u,l=t.exports={},c=[],f=!1,s=-1;l.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new o(e,t)),1!==c.length||f||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=a,l.addListener=a,l.once=a,l.off=a,l.removeListener=a,l.removeAllListeners=a,l.emit=a,l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},{}],4:[function(e,t,n){"use strict";t.exports=e("./lib/core.js"),e("./lib/done.js"),e("./lib/es6-extensions.js"),e("./lib/node-extensions.js")},{"./lib/core.js":5,"./lib/done.js":6,"./lib/es6-extensions.js":7,"./lib/node-extensions.js":8}],5:[function(e,t,n){"use strict";function r(e){function t(e){return null===l?void f.push(e):void a(function(){var t=l?e.onFulfilled:e.onRejected;if(null===t)return void(l?e.resolve:e.reject)(c);var n;try{n=t(c)}catch(r){return void e.reject(r)}e.resolve(n)})}function n(e){try{if(e===s)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void o(t.bind(e),n,r)}l=!0,c=e,u()}catch(i){r(i)}}function r(e){l=!1,c=e,u()}function u(){for(var e=0,n=f.length;n>e;e++)t(f[e]);f=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");var l=null,c=null,f=[],s=this;this.then=function(e,n){return new s.constructor(function(r,o){t(new i(e,n,r,o))})},o(e,n,r)}function i(e,t,n,r){this.onFulfilled="function"==typeof e?e:null,
this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r}function o(e,t,n){var r=!1;try{e(function(e){r||(r=!0,t(e))},function(e){r||(r=!0,n(e))})}catch(i){if(r)return;r=!0,n(i)}}var a=e("asap");t.exports=r},{asap:1}],6:[function(e,t,n){"use strict";var r=e("./core.js"),i=e("asap");t.exports=r,r.prototype.done=function(e,t){var n=arguments.length?this.then.apply(this,arguments):this;n.then(null,function(e){i(function(){throw e})})}},{"./core.js":5,asap:1}],7:[function(e,t,n){"use strict";function r(e){this.then=function(t){return"function"!=typeof t?this:new i(function(n,r){o(function(){try{n(t(e))}catch(i){r(i)}})})}}var i=e("./core.js"),o=e("asap");t.exports=i,r.prototype=i.prototype;var a=new r(!0),u=new r(!1),l=new r(null),c=new r(void 0),f=new r(0),s=new r("");i.resolve=function(e){if(e instanceof i)return e;if(null===e)return l;if(void 0===e)return c;if(e===!0)return a;if(e===!1)return u;if(0===e)return f;if(""===e)return s;if("object"==typeof e||"function"==typeof e)try{var t=e.then;if("function"==typeof t)return new i(t.bind(e))}catch(n){return new i(function(e,t){t(n)})}return new r(e)},i.all=function(e){var t=Array.prototype.slice.call(e);return new i(function(e,n){function r(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var u=a.then;if("function"==typeof u)return void u.call(a,function(e){r(o,e)},n)}t[o]=a,0===--i&&e(t)}catch(l){n(l)}}if(0===t.length)return e([]);for(var i=t.length,o=0;o<t.length;o++)r(o,t[o])})},i.reject=function(e){return new i(function(t,n){n(e)})},i.race=function(e){return new i(function(t,n){e.forEach(function(e){i.resolve(e).then(t,n)})})},i.prototype["catch"]=function(e){return this.then(null,e)}},{"./core.js":5,asap:1}],8:[function(e,t,n){"use strict";var r=e("./core.js"),i=e("asap");t.exports=r,r.denodeify=function(e,t){return t=t||1/0,function(){var n=this,i=Array.prototype.slice.call(arguments);return new r(function(r,o){for(;i.length&&i.length>t;)i.pop();i.push(function(e,t){e?o(e):r(t)});var a=e.apply(n,i);!a||"object"!=typeof a&&"function"!=typeof a||"function"!=typeof a.then||r(a)})}},r.nodeify=function(e){return function(){var t=Array.prototype.slice.call(arguments),n="function"==typeof t[t.length-1]?t.pop():null,o=this;try{return e.apply(this,arguments).nodeify(n,o)}catch(a){if(null===n||"undefined"==typeof n)return new r(function(e,t){t(a)});i(function(){n.call(o,a)})}}},r.prototype.nodeify=function(e,t){return"function"!=typeof e?this:void this.then(function(n){i(function(){e.call(t,null,n)})},function(n){i(function(){e.call(t,n)})})}},{"./core.js":5,asap:1}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(l){i=!0,o=l}finally{try{!r&&u["return"]&&u["return"]()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=e("lodash"),a=r(o),u=e("./utils"),l=r(u),c="https://endgame-chess.firebaseio.com",f=8,s=["white","black"],d=["1","2","3","4","5","6","7","8"],h=["a","b","c","d","e","f","g","h"],p=["rook","knight","bishop","queen","king","bishop","knight","rook"],v=function(e){var t=i(e,2),n=t[0],r=t[1];return{pos:n.join(""),type:r}},m=function(e,t){return a["default"].map(a["default"].zip(a["default"].zip(h,l["default"].repeat(e,f)),t),v)};n["default"]={dbBaseUrl:c,usersUrl:c+"/users",gamesUrl:c+"/games",peerJsKey:"e47332e9vb4yrpb9",iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"stun:stun1.l.google.com:19302"},{url:"stun:stun2.l.google.com:19302"},{url:"stun:stun3.l.google.com:19302"},{url:"stun:stun4.l.google.com:19302"}],localMediaWidth:240,mediaWidth:320,mediaHeight:240,mediaMinFrameRate:10,pieces:["pawn","knight","bishop","rook","queen","king"],assets:["board"],sides:s,ranks:d,files:h,startPosition:{white:m("2",l["default"].repeat("pawn",f)).concat(m("1",p)),black:m("7",l["default"].repeat("pawn",f)).concat(m("8",p))},rankToOffset:a["default"].zipObject(d,a["default"].range(f)),fileToOffset:a["default"].zipObject(h,a["default"].range(f)),gameOpts:{boardScale:4.7,boardStartOffset:16.5,tileSize:4.7,tileOpacity:.4,pieceYOffset:1.7,cameraStartPos:{x:30,y:15,z:30},cameraPlayPos:{x:0,y:22,z:45},cameraPlayLookAt:{x:0,y:5,z:0},friendScreenSize:{x:30,y:20,z:5},friendScreenPos:{x:0,y:10,z:-30}},colors:{pieces:{white:{color:14540253,emissive:0,specular:11184810},black:{color:2236962,emissive:0,specular:1118481}},tiles:{active:16753920,legal:8044866,selected:3832473,prevFrom:6475007,prevTo:14297120},clear:"lightgray",friendScreen:14342874}}},{"./utils":18,lodash:2}],10:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}e("./polyfills");var i=e("promise"),o=r(i),a=e("./game"),u=r(a),l=e("./media"),c=r(l),f=e("./routes"),s=r(f),d=e("./rtc"),h=r(d),p=e("./scene"),v=r(p),m=e("./config"),g=r(m),y=e("./views"),b=r(y),w=e("./log"),_=r(w),M={config:g["default"],main:function(){if(v["default"].init(),v["default"].loadGameGeometry().then(v["default"].setupBoard.bind(v["default"])).done(),v["default"].beginRender(),s["default"].isDebugMode())return void this.beginDebugGame();var e=s["default"].parseGameId();e?(this.isHost=!1,this.connectToGame(e)):(this.isHost=!0,this.setupGame())},setupGame:function(){this.side="white",h["default"].init().then(u["default"].create.bind(u["default"])).then(b["default"].showWaitScreen.bind(b["default"])).then(h["default"].listen.bind(h["default"])).then(this.setupMedia.bind(this)).then(this.performMediaCalls.bind(this)).then(this.displayRemoteMedia.bind(this)).then(this.beginGame.bind(this)).done()},connectToGame:function(e){this.side="black",h["default"].init().then(u["default"].join.bind(u["default"],e)).then(h["default"].connect.bind(h["default"])).then(this.setupMedia.bind(this)).then(this.performMediaCalls.bind(this)).then(this.displayRemoteMedia.bind(this)).then(this.beginGame.bind(this)).done()},setupMedia:function(){var e=this;return(0,_["default"])("setting up the media"),b["default"].showMediaScreen().then(function(){return o["default"].all([new o["default"](function(t,n){h["default"].addDataListener(function(n,r){"mediarequestcomplete"===n.event?(e.remoteHasMedia=n.hasMedia,(0,_["default"])("remote media request complete:",e.remoteHasMedia),t()):(0,_["default"])("ERROR: unknown event type",n.event)},!0)}),c["default"].init().then(function(){e.localHasMedia=!0,(0,_["default"])("local media granted"),c["default"].playLocalStream(),h["default"].sendData({event:"mediarequestcomplete",hasMedia:!0})},function(){e.localHasMedia=!1,(0,_["default"])("local media denied"),h["default"].sendData({event:"mediarequestcomplete",hasMedia:!1})})])})},performMediaCalls:function(){if((0,_["default"])("performing remote media calls"),!this.localHasMedia&&!this.remoteHasMedia)return o["default"].resolve();var e=this.isHost&&this.localHasMedia||!this.isHost&&!this.remoteHasMedia&&this.localHasMedia;return h["default"].performMediaCall(e,this.localHasMedia&&c["default"].localMediaStream)},displayRemoteMedia:function(e){var t=this;return new o["default"](function(n,r){t.remoteHasMedia?e.on("stream",function(e){var r=c["default"].configureRemoteStream(e);v["default"].addFriendScreen(t.side,r),n()}):(v["default"].addFriendScreen(t.side),n())})},beginGame:function(){var e=this;(0,_["default"])("commencing game"),b["default"].showStatusScreen().then(function(){return new o["default"](function(t,n){e.chess=new Chess,e.isMyTurn="white"===e.side,v["default"].addTileControls(function(t){return e.chess.moves({square:t,verbose:!0})},function(t,n,i){var o=e.chess.move({from:t,to:n,promotion:i});o?(s["default"].isDebugMode()||h["default"].sendData({event:"chessmove",move:o}),r(o)):(0,_["default"])("ERROR: illegal move attempted locally - bug?")},function(){return b["default"].showPromotionScreen(e.side)});var r=function(t){e.isMyTurn=!e.isMyTurn,s["default"].isDebugMode()&&(e.side="white"===e.side?"black":"white"),v["default"].performGraphicalMove(t)};s["default"].isDebugMode()||h["default"].addDataListener(function(t,n){if("chessmove"===t.event)if(e.isMyTurn)(0,_["default"])("ERROR: opponent attempted to move on my turn");else{var i=e.chess.move(t.move);i?r(i):(0,_["default"])("ERROR: opponent attempted invalid move",t)}else(0,_["default"])("ERROR: unknown event type",t.event)})})}).done()},beginDebugGame:function(){this.side="white",v["default"].setPlayCameraPos(this.side),this.beginGame()}};window.endgame=M,M.main()},{"./config":9,"./game":11,"./log":12,"./media":13,"./polyfills":14,"./routes":15,"./rtc":16,"./scene":17,"./views":19,promise:4}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("promise"),o=r(i),a=e("./config"),u=r(a);n["default"]={create:function(e){return this.ref=new Firebase(u["default"].gamesUrl),this.gameRef=this.ref.push(),this.gameRef.set({hostId:e}),o["default"].resolve(this.gameRef.key())},join:function(e){var t=this;return this.ref=new Firebase(u["default"].gamesUrl),this.gameRef=this.ref.child(e),new o["default"](function(e,n){t.gameRef.once("value",function(t){e(t.val().hostId)})})}}},{"./config":9,promise:4}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=function(){window.console&&r&&console.log.apply(console,Array.prototype.slice.call(arguments))};var r=!0},{}],13:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("promise"),o=r(i),a=e("./config"),u=r(a);n["default"]={init:function(){var e=this;return new o["default"](function(t,n){return navigator.getUserMedia?void navigator.getUserMedia({video:{mandatory:{maxWidth:u["default"].mediaWidth,maxHeight:u["default"].mediaHeight,minFrameRate:u["default"].mediaMinFrameRate}},audio:!0},function(n){e.localMediaStream=n,t(n)},n):n()})},playLocalStream:function(){var e=$("#localvideo").get(0);this.playStream(this.localMediaStream,e);var t=!1;e.addEventListener("canplay",function(n){t||!e.videoHeight&&!e.videoWidth||(t=!0,e.width=u["default"].localMediaWidth,e.height=e.videoHeight/(e.videoWidth/u["default"].localMediaWidth),$("#localvideopanel").show("slow"))},!1)},configureRemoteStream:function(e){this.remoteMediaStream=e;var t=document.createElement("video");return this.playStream(e,t),t},playStream:function(e,t){t.autoplay=!0,navigator.mozGetUserMedia?t.mozSrcObject=e:t.src=window.URL.createObjectURL(e)}}},{"./config":9,promise:4}],14:[function(e,t,n){"use strict";!function(){for(var e=0,t=["webkit","moz"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),r=Math.max(0,16-(n-e)),i=window.setTimeout(function(){t(n+r)},r);return e=n+r,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}(),function(){window.URL=window.URL||window.webkitURL}()},{}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("lodash"),o=r(i),a=e("./utils"),u=r(a);n["default"]={parseGameId:function(){return o["default"].last(u["default"].pathParts(window.location.pathname))||window.location.hash.substring(1)},genGameUrl:function(e){var t=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),n=this.isDevMode()?"#":"";return t+"/"+n+e},isDevMode:function(){return"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname},isDebugMode:function(){if(!this._isDebugMode){var e=u["default"].queryStringParts(window.location.search);this._isDebugMode="true"===e.debug}return this._isDebugMode}}},{"./utils":18,lodash:2}],16:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("promise"),o=r(i),a=e("lodash"),u=r(a),l=e("./config"),c=r(l),f=e("./routes"),s=r(f);n["default"]={init:function(){var e=this;return this.peer=new Peer({key:c["default"].peerJsKey,secure:!s["default"].isDevMode(),config:{iceServers:c["default"].iceServers},debug:2}),new o["default"](function(t,n){e.peer.on("open",t)})},listen:function(){var e=this;return new o["default"](function(t,n){e.peer.on("connection",function(n){e.conn=n,e.remoteId=n.peer,e.setupDataBus(n),t(n)})})},connect:function(e){var t=this.peer.connect(e,{reliable:!0});return this.conn=t,this.remoteId=t.peer,this.setupDataBus(t),o["default"].resolve(t)},setupDataBus:function(e){var t=this;this.queuedData=[],this.listeners=[],e.on("open",function(){e.on("data",function(n){var r=t.listeners.slice();u["default"].forEach(r,function(r){if(r.fn.call(t,n,e),r.once){var i=t.listeners.indexOf(r);-1!==i&&t.listeners.splice(i,1)}})}),u["default"].forEach(t.queuedData,function(e){t.conn.send(e)})})},addDataListener:function(e,t){this.listeners.push({fn:e,once:t})},sendData:function(e){this.conn.open?this.conn.send(e):this.queuedData.push(e)},performMediaCall:function(e,t){var n=this;return new o["default"](function(r,i){e?(n.call=n.peer.call(n.remoteId,t),r(n.call)):n.peer.on("call",function(e){n.call=e,t&&e.answer(t),r(n.call)})})}}},{"./config":9,"./routes":15,lodash:2,promise:4}],17:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("promise"),o=r(i),a=e("lodash"),u=r(a),l=e("./config"),c=r(l),f=e("./log"),s=r(f);n["default"]={init:function(){this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3),this.renderer=this.createRenderer(),this.renderer.setClearColor(new THREE.Color(c["default"].colors.clear),1),this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),window.addEventListener("resize",this.resize.bind(this),!1),this.addLighting(),this.setInitialCameraPos()},resize:function(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)},createRenderer:function(){var e=this.webglAvailable()?new THREE.WebGLRenderer({antialias:!0}):new THREE.CanvasRenderer;return e},webglAvailable:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(t){return!1}},addLighting:function(){this.dirLight=new THREE.DirectionalLight(16777215,.9),this.dirLight.position.set(0,80,0).normalize(),this.scene.add(this.dirLight),this.hemiLight=new THREE.HemisphereLight(16777215,16777215,.2),this.scene.add(this.hemiLight)},setInitialCameraPos:function(){this.camera.position.x=c["default"].gameOpts.cameraStartPos.x,this.camera.position.y=c["default"].gameOpts.cameraStartPos.y,this.camera.position.z=c["default"].gameOpts.cameraStartPos.z,this.camera.lookAt(new THREE.Vector3(0,0,0))},setPlayCameraPos:function(e){this.camera.position.x=c["default"].gameOpts.cameraPlayPos.x,this.camera.position.y=c["default"].gameOpts.cameraPlayPos.y,this.camera.position.z=("black"===e?-1:1)*c["default"].gameOpts.cameraPlayPos.z,this.camera.lookAt(new THREE.Vector3(c["default"].gameOpts.cameraPlayLookAt.x,c["default"].gameOpts.cameraPlayLookAt.y,c["default"].gameOpts.cameraPlayLookAt.z))},loadGameGeometry:function(){var e=this;return this.meshes={},o["default"].all(u["default"].map(c["default"].pieces.concat(c["default"].assets),function(t){return new o["default"](function(n,r){var i=new THREE.JSONLoader;i.load("data/"+t+".json",function(r,i){var o=i[0];if(u["default"].contains(c["default"].assets,t)){var a=new THREE.Mesh(r,o);e.meshes[t]=a}else r.computeFaceNormals(),r.computeVertexNormals(),u["default"].forEach(c["default"].sides,function(n){var i=o.clone();i.color.setHex(c["default"].colors.pieces[n].color),i.emissive.setHex(c["default"].colors.pieces[n].emissive),i.specular.setHex(c["default"].colors.pieces[n].specular);var a=new THREE.Mesh(r,i);e.meshes[n]||(e.meshes[n]={}),e.meshes[n][t]=a});(0,s["default"])("done loading",t),n()})})}))},setupBoard:function(){this.addSkybox(),this.addBoard(),this.addPieces()},addSkybox:function(){var e=new THREE.MeshLambertMaterial({color:14342874,depthWrite:!1,side:THREE.BackSide}),t=new THREE.Mesh(new THREE.BoxGeometry(150,100,200),e);t.position.set(0,50,0),this.scene.add(t)},addBoard:function(){this.board=new THREE.Object3D,this.board.add(this.meshes.board),this.board.scale.set(c["default"].gameOpts.boardScale,c["default"].gameOpts.boardScale,c["default"].gameOpts.boardScale),this.scene.add(this.board)},addPieces:function(){var e=this;this.pieces={},this.captured={w:[],b:[]},u["default"].forEach(c["default"].startPosition,function(t,n){u["default"].forEach(t,function(t){e.addPiece(t.pos,t.type,n)})})},addPiece:function(e,t,n){(0,s["default"])("creating",t,n);var r=new THREE.Object3D;r.add(this.meshes[n][t].clone()),r.position.setY(c["default"].gameOpts.pieceYOffset),this.setPiecePosition(r,e),"white"===n&&(r.rotation.y=Math.PI),this.scene.add(r),this.pieces[e]={type:t,side:n,object:r}},addFriendScreen:function(e,t){var n=void 0;t?(this.friendVideo=t,this.friendTexture=new THREE.Texture(t),this.friendTexture.generateMipmaps=!1,n=new THREE.MeshLambertMaterial({map:this.friendTexture,emissive:15658734})):n=new THREE.MeshLambertMaterial({color:0});var r=new THREE.MeshLambertMaterial({color:c["default"].colors.friendScreen}),i=[r,r,r,r,n,r],o=new THREE.BoxGeometry(c["default"].gameOpts.friendScreenSize.x,c["default"].gameOpts.friendScreenSize.y,c["default"].gameOpts.friendScreenSize.z),a=new THREE.Mesh(o,new THREE.MeshFaceMaterial(i));a.position.set(c["default"].gameOpts.friendScreenPos.x,c["default"].gameOpts.friendScreenPos.y,c["default"].gameOpts.friendScreenPos.z),"black"===e&&(a.position.setZ(-c["default"].gameOpts.friendScreenPos.z),a.rotation.y=Math.PI),this.scene.add(a),this.setPlayCameraPos(e)},addTileControls:function(e,t,n){var r=this;this.legalCallback=e,this.moveCallback=t,this.onPromotion=n,this.tiles={};var i=new THREE.PlaneGeometry(c["default"].gameOpts.tileSize,c["default"].gameOpts.tileSize),o=new THREE.MeshLambertMaterial({color:c["default"].colors.tiles.active,side:THREE.DoubleSide,transparent:!0,opacity:0});u["default"].forEach(c["default"].files,function(e){u["default"].forEach(c["default"].ranks,function(t){r.addTileControl(e+t,i,o.clone())})}),this.raycaster=new THREE.Raycaster,this.addMouseListeners()},addTileControl:function(e,t,n){var r=c["default"].fileToOffset[e[0]],i=c["default"].rankToOffset[e[1]],o=new THREE.Mesh(t,n);o.rotation.x=Math.PI/2,o.position.setY(c["default"].gameOpts.pieceYOffset+.05),o.position.setX(-c["default"].gameOpts.boardStartOffset+r*c["default"].gameOpts.tileSize),o.position.setZ(c["default"].gameOpts.boardStartOffset-i*c["default"].gameOpts.tileSize),o.isTile=!0,o.chessPos=e,this.tiles[e]=o,this.scene.add(o)},addMouseListeners:function(){this.mousePos=new THREE.Vector2,document.addEventListener("mousemove",this.onMouseMove.bind(this),!1),document.addEventListener("mousedown",this.onMouseDown.bind(this),!1),document.addEventListener("mouseup",this.onMouseUp.bind(this),!1)},onMouseMove:function(e){this.updateMousePos(e),this.highlightActiveTile()},updateMousePos:function(e){this.mousePos.x=e.clientX/window.innerWidth*2-1,this.mousePos.y=2*-(e.clientY/window.innerHeight)+1},highlightActiveTile:function(){this.recolorTiles();var e=this.intersectTile();if(e){var t=e.object;this.colorTile(t,c["default"].colors.tiles.active)}},onMouseDown:function(e){e.preventDefault(),this.handleMoveSelection()},handleMoveSelection:function(){var e=this,t=this.intersectTile();t&&!function(){var n=t.object;e.isSelectingPieceMovement?n.isLegalMove?n.isPromotion?e.onPromotion().then(function(t){e.commitMove(n,t),e.resetTileHighlights()}):(e.commitMove(n),e.resetTileHighlights()):(e.resetTileHighlights(),e.highlightLegalMoves(n)):e.highlightLegalMoves(n)}()},commitMove:function(e,t){this.moveCallback(this.selectedPos,e.chessPos,t),this.isSelectingPieceMovement=!1,this.selectedPos=null},highlightLegalMoves:function(e){var t=this;this.isSelectingPieceMovement=!0,this.selectedPos=e.chessPos,this.colorTile(e,c["default"].colors.tiles.selected),this.currentLegalMoves=this.legalCallback(e.chessPos),u["default"].forEach(this.currentLegalMoves,function(e){var n=t.tiles[e.to];n.isLegalMove=!0,n.isPromotion=-1!==e.flags.indexOf("p"),t.colorTile(n,c["default"].colors.tiles.legal)})},resetTileHighlights:function(){u["default"].forEach(this.tiles,function(e){e.isLegalMove=null}),this.recolorTiles()},recolorTiles:function(){var e=this;u["default"].forEach(this.tiles,function(t){e.hideTile(t),t.isLegalMove?e.colorTile(t,c["default"].colors.tiles.legal):t.chessPos==e.selectedPos?e.colorTile(t,c["default"].colors.tiles.selected):t.chessPos===e.prevPosFrom?e.colorTile(t,c["default"].colors.tiles.prevFrom):t.chessPos===e.prevPosTo&&e.colorTile(t,c["default"].colors.tiles.prevTo)})},colorTile:function(e,t){e.material.color.setHex(t),e.material.opacity=c["default"].gameOpts.tileOpacity},hideTile:function(e){e.material.opacity=0},performGraphicalMove:function(e){var t=this,n=this.pieces[e.from];if("undefined"==typeof n)return void(0,s["default"])("ERROR: piece not found - bug?");this.prevPosFrom=e.from,this.prevPosTo=e.to;var r=function(e,r){var i=t.pieces[r];delete t.pieces[r],t.captured[e.color].push(i),t.hidePiece(i.object),delete t.pieces[e.from],t.pieces[e.to]=n,t.setPiecePosition(n.object,e.to)},i=function(e){delete t.pieces[e.from],t.pieces[e.to]=n,t.setPiecePosition(n.object,e.to);var r=e.to.charAt(0)>e.from.charAt(0)?"kingside":"queenside",i={kingside:{w:{from:"h1",to:"f1"},b:{from:"h8",to:"f8"}},queenside:{w:{from:"a1",to:"d1"},b:{from:"a8",to:"d8"}}},o=i[r][e.color].from,a=i[r][e.color].to,u=t.pieces[o];delete t.pieces[o],t.pieces[a]=u,t.setPiecePosition(u.object,a)};if(-1!==e.flags.indexOf("e")){var o=e.to.charAt(0)+e.from.charAt(1);r(e,o)}if(-1!==e.flags.indexOf("c")&&r(e,e.to),-1===e.flags.indexOf("n")&&-1===e.flags.indexOf("b")||(delete this.pieces[e.from],this.pieces[e.to]=n,this.setPiecePosition(n.object,e.to)),-1!==e.flags.indexOf("p")){var a={q:"queen",r:"rook",b:"bishop",n:"knight"};n.object.remove(n.object.children[0]);var u=a[e.promotion];n.object.add(this.meshes[n.side][u].clone())}-1!==e.flags.indexOf("k")&&i(e),-1!==e.flags.indexOf("q")&&i(e),this.recolorTiles()},onMouseUp:function(e){e.preventDefault()},intersectTile:function(){this.raycaster.setFromCamera(this.mousePos,this.camera);var e=this.raycaster.intersectObjects(this.scene.children);return u["default"].first(u["default"].filter(e,function(e){return e.object.isTile}))},setPiecePosition:function(e,t){var n=c["default"].fileToOffset[t[0]],r=c["default"].rankToOffset[t[1]];e.position.setX(-c["default"].gameOpts.boardStartOffset+n*c["default"].gameOpts.tileSize),e.position.setZ(c["default"].gameOpts.boardStartOffset-r*c["default"].gameOpts.tileSize)},hidePiece:function(e){e.visible=!1},beginRender:function(){this.render=this.render.bind(this),this.previousTime=(new Date).getTime(),this.requestId=requestAnimationFrame(this.render)},render:function(e){this.requestId=requestAnimationFrame(this.render),TWEEN.update(e);var t=(new Date).getTime();t-this.previousTime;this.previousTime=t,this.friendVideo&&this.friendVideo.readyState===this.friendVideo.HAVE_ENOUGH_DATA&&(this.friendTexture.needsUpdate=!0),this.renderer.render(this.scene,this.camera)}}},{"./config":9,"./log":12,lodash:2,promise:4}],18:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(l){i=!0,o=l}finally{try{!r&&u["return"]&&u["return"]()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=e("lodash"),a=r(o);n["default"]={pathParts:function(e){return a["default"].filter(e.split("/"))},queryStringParts:function(e){var t=/\+/g,n=/([^&=]+)=?([^&]*)/g,r=function(e){return decodeURIComponent(e.replace(t," "))};"?"===e.charAt(0)&&(e=e.slice(1));for(var o={},a=void 0;a=n.exec(e);){var u=a,l=i(u,3),c=l[1],f=l[2];o[r(c)]=r(f)}return o},repeat:function(e,t){return a["default"].map(Array.apply(null,new Array(t)),this.identity.bind(null,e))},identity:function(e){return e}}},{lodash:2}],19:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("promise"),o=r(i),a=e("./routes"),u=r(a);n["default"]={showWaitScreen:function(e){return this.waitScreen=new Vue({el:"#waitscreen",data:{link:u["default"].genGameUrl(e)}}),$("#waitscreen").modal({backdrop:!1,keyboard:!1}),o["default"].resolve()},showMediaScreen:function(){return $("#waitscreen").modal("hide"),$("#mediascreen").modal({backdrop:!1,keyboard:!1}),o["default"].resolve()},showStatusScreen:function(){return $("#mediascreen").modal("hide"),o["default"].resolve()},showPromotionScreen:function(e){var t=this;return new o["default"](function(n,r){var i=function(e,r){r.preventDefault(),$("#promotionscreen").modal("hide"),t.promotionScreen.$destroy();var i={queen:"q",rook:"r",bishop:"b",knight:"n"}[e];n(i)};t.promotionScreen=new Vue({el:"#promotionscreen",data:{color:e,pieces:["queen","rook","bishop","knight"]},methods:{onClick:i}}),$("#promotionscreen").modal({backdrop:!0,keyboard:!1})})}}},{"./routes":15,promise:4}]},{},[10]);
//# sourceMappingURL=endgame.min.js.map
