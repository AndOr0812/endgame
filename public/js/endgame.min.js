!function e(n,t,r){function i(a,u){if(!t[a]){if(!n[a]){var c="function"==typeof require&&require;if(!u&&c)return c(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var f=t[a]={exports:{}};n[a][0].call(f.exports,function(e){var t=n[a][1][e];return i(t?t:e)},f,f.exports,e,n,t,r)}return t[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,n,t){(function(e){function t(){for(;i.next;){i=i.next;var e=i.task;i.task=void 0;var n=i.domain;n&&(i.domain=void 0,n.enter());try{e()}catch(r){if(c)throw n&&n.exit(),setTimeout(t,0),n&&n.enter(),r;setTimeout(function(){throw r},0)}n&&n.exit()}a=!1}function r(n){o=o.next={task:n,domain:c&&e.domain,next:null},a||(a=!0,u())}var i={task:void 0,next:null},o=i,a=!1,u=void 0,c=!1;if("undefined"!=typeof e&&e.nextTick)c=!0,u=function(){e.nextTick(t)};else if("function"==typeof setImmediate)u="undefined"!=typeof window?setImmediate.bind(window,t):function(){setImmediate(t)};else if("undefined"!=typeof MessageChannel){var l=new MessageChannel;l.port1.onmessage=t,u=function(){l.port2.postMessage(0)}}else u=function(){setTimeout(t,0)};n.exports=r}).call(this,e("_process"))},{_process:3}],2:[function(e,n,t){(function(e){(function(){function r(e,n,t){for(var r=(t||0)-1,i=e?e.length:0;++r<i;)if(e[r]===n)return r;return-1}function i(e,n){var t=typeof n;if(e=e.cache,"boolean"==t||null==n)return e[n]?0:-1;"number"!=t&&"string"!=t&&(t="object");var i="number"==t?n:w+n;return e=(e=e[t])&&e[i],"object"==t?e&&r(e,n)>-1?0:-1:e?0:-1}function o(e){var n=this.cache,t=typeof e;if("boolean"==t||null==e)n[e]=!0;else{"number"!=t&&"string"!=t&&(t="object");var r="number"==t?e:w+e,i=n[t]||(n[t]={});"object"==t?(i[r]||(i[r]=[])).push(e):i[r]=!0}}function a(e){return e.charCodeAt(0)}function u(e,n){for(var t=e.criteria,r=n.criteria,i=-1,o=t.length;++i<o;){var a=t[i],u=r[i];if(a!==u){if(a>u||"undefined"==typeof a)return 1;if(u>a||"undefined"==typeof u)return-1}}return e.index-n.index}function c(e){var n=-1,t=e.length,r=e[0],i=e[t/2|0],a=e[t-1];if(r&&"object"==typeof r&&i&&"object"==typeof i&&a&&"object"==typeof a)return!1;var u=s();u["false"]=u["null"]=u["true"]=u.undefined=!1;var c=s();for(c.array=e,c.cache=u,c.push=o;++n<t;)c.push(e[n]);return c}function l(e){return"\\"+J[e]}function f(){return g.pop()||[]}function s(){return y.pop()||{array:null,cache:null,criteria:null,"false":!1,index:0,"null":!1,number:null,object:null,push:null,string:null,"true":!1,undefined:!1,value:null}}function p(e){e.length=0,g.length<x&&g.push(e)}function d(e){var n=e.cache;n&&d(n),e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null,y.length<x&&y.push(e)}function h(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,i=t-n||0,o=Array(0>i?0:i);++r<i;)o[r]=e[n+r];return o}function v(e){function n(e){return e&&"object"==typeof e&&!Zt(e)&&Lt.call(e,"__wrapped__")?e:new t(e)}function t(e,n){this.__chain__=!!n,this.__wrapped__=e}function o(e){function n(){if(r){var e=h(r);At.apply(e,arguments)}if(this instanceof n){var o=y(t.prototype),a=t.apply(o,e||arguments);return Se(a)?a:o}return t.apply(i,e||arguments)}var t=e[0],r=e[2],i=e[4];return Xt(n,e),n}function g(e,n,t,r,i){if(t){var o=t(e);if("undefined"!=typeof o)return o}var a=Se(e);if(!a)return e;var u=Rt.call(e);if(!$[u])return e;var c=Kt[u];switch(u){case I:case q:return new c(+e);case G:case B:return new c(e);case N:return o=c(e.source,j.exec(e)),o.lastIndex=e.lastIndex,o}var l=Zt(e);if(n){var s=!r;r||(r=f()),i||(i=f());for(var d=r.length;d--;)if(r[d]==e)return i[d];o=l?c(e.length):{}}else o=l?h(e):or({},e);return l&&(Lt.call(e,"index")&&(o.index=e.index),Lt.call(e,"input")&&(o.input=e.input)),n?(r.push(e),i.push(o),(l?Je:cr)(e,function(e,a){o[a]=g(e,n,t,r,i)}),s&&(p(r),p(i)),o):o}function y(e,n){return Se(e)?qt(e):{}}function x(e,n,t){if("function"!=typeof e)return Zn;if("undefined"==typeof n||!("prototype"in e))return e;var r=e.__bindData__;if("undefined"==typeof r&&(Jt.funcNames&&(r=!e.name),r=r||!Jt.funcDecomp,!r)){var i=Ht.call(e);Jt.funcNames||(r=!k.test(i)),r||(r=C.test(i),Xt(e,r))}if(r===!1||r!==!0&&1&r[1])return e;switch(t){case 1:return function(t){return e.call(n,t)};case 2:return function(t,r){return e.call(n,t,r)};case 3:return function(t,r,i){return e.call(n,t,r,i)};case 4:return function(t,r,i,o){return e.call(n,t,r,i,o)}}return An(e,n)}function J(e){function n(){var e=c?a:this;if(i){var d=h(i);At.apply(d,arguments)}if((o||f)&&(d||(d=h(arguments)),o&&At.apply(d,o),f&&d.length<u))return r|=16,J([t,s?r:-4&r,d,null,a,u]);if(d||(d=arguments),l&&(t=e[p]),this instanceof n){e=y(t.prototype);var v=t.apply(e,d);return Se(v)?v:e}return t.apply(e,d)}var t=e[0],r=e[1],i=e[2],o=e[3],a=e[4],u=e[5],c=1&r,l=2&r,f=4&r,s=8&r,p=t;return Xt(n,e),n}function Z(e,n){var t=-1,o=ce(),a=e?e.length:0,u=a>=_&&o===r,l=[];if(u){var f=c(n);f?(o=i,n=f):u=!1}for(;++t<a;){var s=e[t];o(n,s)<0&&l.push(s)}return u&&d(n),l}function Q(e,n,t,r){for(var i=(r||0)-1,o=e?e.length:0,a=[];++i<o;){var u=e[i];if(u&&"object"==typeof u&&"number"==typeof u.length&&(Zt(u)||pe(u))){n||(u=Q(u,n,t));var c=-1,l=u.length,f=a.length;for(a.length+=l;++c<l;)a[f++]=u[c]}else t||a.push(u)}return a}function ee(e,n,t,r,i,o){if(t){var a=t(e,n);if("undefined"!=typeof a)return!!a}if(e===n)return 0!==e||1/e==1/n;var u=typeof e,c=typeof n;if(!(e!==e||e&&K[u]||n&&K[c]))return!1;if(null==e||null==n)return e===n;var l=Rt.call(e),s=Rt.call(n);if(l==F&&(l=W),s==F&&(s=W),l!=s)return!1;switch(l){case I:case q:return+e==+n;case G:return e!=+e?n!=+n:0==e?1/e==1/n:e==+n;case N:case B:return e==xt(n)}var d=l==D;if(!d){var h=Lt.call(e,"__wrapped__"),v=Lt.call(n,"__wrapped__");if(h||v)return ee(h?e.__wrapped__:e,v?n.__wrapped__:n,t,r,i,o);if(l!=W)return!1;var m=e.constructor,g=n.constructor;if(m!=g&&!(ke(m)&&m instanceof m&&ke(g)&&g instanceof g)&&"constructor"in e&&"constructor"in n)return!1}var y=!i;i||(i=f()),o||(o=f());for(var b=i.length;b--;)if(i[b]==e)return o[b]==n;var w=0;if(a=!0,i.push(e),o.push(n),d){if(b=e.length,w=n.length,a=w==b,a||r)for(;w--;){var _=b,x=n[w];if(r)for(;_--&&!(a=ee(e[_],x,t,r,i,o)););else if(!(a=ee(e[w],x,t,r,i,o)))break}}else ur(n,function(n,u,c){return Lt.call(c,u)?(w++,a=Lt.call(e,u)&&ee(e[u],n,t,r,i,o)):void 0}),a&&!r&&ur(e,function(e,n,t){return Lt.call(t,n)?a=--w>-1:void 0});return i.pop(),o.pop(),y&&(p(i),p(o)),a}function ne(e,n,t,r,i){(Zt(n)?Je:cr)(n,function(n,o){var a,u,c=n,l=e[o];if(n&&((u=Zt(n))||lr(n))){for(var f=r.length;f--;)if(a=r[f]==n){l=i[f];break}if(!a){var s;t&&(c=t(l,n),(s="undefined"!=typeof c)&&(l=c)),s||(l=u?Zt(l)?l:[]:lr(l)?l:{}),r.push(n),i.push(l),s||ne(l,n,t,r,i)}}else t&&(c=t(l,n),"undefined"==typeof c&&(c=n)),"undefined"!=typeof c&&(l=c);e[o]=l})}function re(e,n){return e+Pt(Yt()*(n-e+1))}function ie(e,n,t){var o=-1,a=ce(),u=e?e.length:0,l=[],s=!n&&u>=_&&a===r,h=t||s?f():l;if(s){var v=c(h);a=i,h=v}for(;++o<u;){var m=e[o],g=t?t(m,o,e):m;(n?!o||h[h.length-1]!==g:a(h,g)<0)&&((t||s)&&h.push(g),l.push(m))}return s?(p(h.array),d(h)):t&&p(h),l}function oe(e){return function(t,r,i){var o={};r=n.createCallback(r,i,3);var a=-1,u=t?t.length:0;if("number"==typeof u)for(;++a<u;){var c=t[a];e(o,c,r(c,a,t),t)}else cr(t,function(n,t,i){e(o,n,r(n,t,i),i)});return o}}function ae(e,n,t,r,i,a){var u=1&n,c=2&n,l=4&n,f=16&n,s=32&n;if(!c&&!ke(e))throw new Tt;f&&!t.length&&(n&=-17,f=t=!1),s&&!r.length&&(n&=-33,s=r=!1);var p=e&&e.__bindData__;if(p&&p!==!0)return p=h(p),p[2]&&(p[2]=h(p[2])),p[3]&&(p[3]=h(p[3])),!u||1&p[1]||(p[4]=i),!u&&1&p[1]&&(n|=8),!l||4&p[1]||(p[5]=a),f&&At.apply(p[2]||(p[2]=[]),t),s&&Dt.apply(p[3]||(p[3]=[]),r),p[1]|=n,ae.apply(null,p);var d=1==n||17===n?o:J;return d([e,n,t,r,i,a])}function ue(e){return nr[e]}function ce(){var e=(e=n.indexOf)===yn?r:e;return e}function le(e){return"function"==typeof e&&jt.test(e)}function fe(e){var n,t;return e&&Rt.call(e)==W&&(n=e.constructor,!ke(n)||n instanceof n)?(ur(e,function(e,n){t=n}),"undefined"==typeof t||Lt.call(e,t)):!1}function se(e){return tr[e]}function pe(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Rt.call(e)==F||!1}function de(e,n,t,r){return"boolean"!=typeof n&&null!=n&&(r=t,t=n,n=!1),g(e,n,"function"==typeof t&&x(t,r,1))}function he(e,n,t){return g(e,!0,"function"==typeof n&&x(n,t,1))}function ve(e,n){var t=y(e);return n?or(t,n):t}function me(e,t,r){var i;return t=n.createCallback(t,r,3),cr(e,function(e,n,r){return t(e,n,r)?(i=n,!1):void 0}),i}function ge(e,t,r){var i;return t=n.createCallback(t,r,3),be(e,function(e,n,r){return t(e,n,r)?(i=n,!1):void 0}),i}function ye(e,n,t){var r=[];ur(e,function(e,n){r.push(n,e)});var i=r.length;for(n=x(n,t,3);i--&&n(r[i--],r[i],e)!==!1;);return e}function be(e,n,t){var r=er(e),i=r.length;for(n=x(n,t,3);i--;){var o=r[i];if(n(e[o],o,e)===!1)break}return e}function we(e){var n=[];return ur(e,function(e,t){ke(e)&&n.push(t)}),n.sort()}function _e(e,n){return e?Lt.call(e,n):!1}function xe(e){for(var n=-1,t=er(e),r=t.length,i={};++n<r;){var o=t[n];i[e[o]]=o}return i}function Te(e){return e===!0||e===!1||e&&"object"==typeof e&&Rt.call(e)==I||!1}function Ee(e){return e&&"object"==typeof e&&Rt.call(e)==q||!1}function Me(e){return e&&1===e.nodeType||!1}function Oe(e){var n=!0;if(!e)return n;var t=Rt.call(e),r=e.length;return t==D||t==B||t==F||t==W&&"number"==typeof r&&ke(e.splice)?!r:(cr(e,function(){return n=!1}),n)}function Re(e,n,t,r){return ee(e,n,"function"==typeof t&&x(t,r,2))}function je(e){return Gt(e)&&!Wt(parseFloat(e))}function ke(e){return"function"==typeof e}function Se(e){return!(!e||!K[typeof e])}function Pe(e){return Ce(e)&&e!=+e}function He(e){return null===e}function Ce(e){return"number"==typeof e||e&&"object"==typeof e&&Rt.call(e)==G||!1}function Le(e){return e&&"object"==typeof e&&Rt.call(e)==N||!1}function Ae(e){return"string"==typeof e||e&&"object"==typeof e&&Rt.call(e)==B||!1}function ze(e){return"undefined"==typeof e}function Fe(e,t,r){var i={};return t=n.createCallback(t,r,3),cr(e,function(e,n,r){i[n]=t(e,n,r)}),i}function De(e){var n=arguments,t=2;if(!Se(e))return e;if("number"!=typeof n[2]&&(t=n.length),t>3&&"function"==typeof n[t-2])var r=x(n[--t-1],n[t--],2);else t>2&&"function"==typeof n[t-1]&&(r=n[--t]);for(var i=h(arguments,1,t),o=-1,a=f(),u=f();++o<t;)ne(e,i[o],r,a,u);return p(a),p(u),e}function Ie(e,t,r){var i={};if("function"!=typeof t){var o=[];ur(e,function(e,n){o.push(n)}),o=Z(o,Q(arguments,!0,!1,1));for(var a=-1,u=o.length;++a<u;){var c=o[a];i[c]=e[c]}}else t=n.createCallback(t,r,3),ur(e,function(e,n,r){t(e,n,r)||(i[n]=e)});return i}function qe(e){for(var n=-1,t=er(e),r=t.length,i=ht(r);++n<r;){var o=t[n];i[n]=[o,e[o]]}return i}function Ue(e,t,r){var i={};if("function"!=typeof t)for(var o=-1,a=Q(arguments,!0,!1,1),u=Se(e)?a.length:0;++o<u;){var c=a[o];c in e&&(i[c]=e[c])}else t=n.createCallback(t,r,3),ur(e,function(e,n,r){t(e,n,r)&&(i[n]=e)});return i}function Ge(e,t,r,i){var o=Zt(e);if(null==r)if(o)r=[];else{var a=e&&e.constructor,u=a&&a.prototype;r=y(u)}return t&&(t=n.createCallback(t,i,4),(o?Je:cr)(e,function(e,n,i){return t(r,e,n,i)})),r}function We(e){for(var n=-1,t=er(e),r=t.length,i=ht(r);++n<r;)i[n]=e[t[n]];return i}function Ne(e){for(var n=arguments,t=-1,r=Q(n,!0,!1,1),i=n[2]&&n[2][n[1]]===e?1:r.length,o=ht(i);++t<i;)o[t]=e[r[t]];return o}function Be(e,n,t){var r=-1,i=ce(),o=e?e.length:0,a=!1;return t=(0>t?Bt(0,o+t):t)||0,Zt(e)?a=i(e,n,t)>-1:"number"==typeof o?a=(Ae(e)?e.indexOf(n,t):i(e,n,t))>-1:cr(e,function(e){return++r>=t?!(a=e===n):void 0}),a}function $e(e,t,r){var i=!0;t=n.createCallback(t,r,3);var o=-1,a=e?e.length:0;if("number"==typeof a)for(;++o<a&&(i=!!t(e[o],o,e)););else cr(e,function(e,n,r){return i=!!t(e,n,r)});return i}function Ve(e,t,r){var i=[];t=n.createCallback(t,r,3);var o=-1,a=e?e.length:0;if("number"==typeof a)for(;++o<a;){var u=e[o];t(u,o,e)&&i.push(u)}else cr(e,function(e,n,r){t(e,n,r)&&i.push(e)});return i}function Ye(e,t,r){t=n.createCallback(t,r,3);var i=-1,o=e?e.length:0;if("number"!=typeof o){var a;return cr(e,function(e,n,r){return t(e,n,r)?(a=e,!1):void 0}),a}for(;++i<o;){var u=e[i];if(t(u,i,e))return u}}function Ke(e,t,r){var i;return t=n.createCallback(t,r,3),Xe(e,function(e,n,r){return t(e,n,r)?(i=e,!1):void 0}),i}function Je(e,n,t){var r=-1,i=e?e.length:0;if(n=n&&"undefined"==typeof t?n:x(n,t,3),"number"==typeof i)for(;++r<i&&n(e[r],r,e)!==!1;);else cr(e,n);return e}function Xe(e,n,t){var r=e?e.length:0;if(n=n&&"undefined"==typeof t?n:x(n,t,3),"number"==typeof r)for(;r--&&n(e[r],r,e)!==!1;);else{var i=er(e);r=i.length,cr(e,function(e,t,o){return t=i?i[--r]:--r,n(o[t],t,o)})}return e}function Ze(e,n){var t=h(arguments,2),r=-1,i="function"==typeof n,o=e?e.length:0,a=ht("number"==typeof o?o:0);return Je(e,function(e){a[++r]=(i?n:e[n]).apply(e,t)}),a}function Qe(e,t,r){var i=-1,o=e?e.length:0;if(t=n.createCallback(t,r,3),"number"==typeof o)for(var a=ht(o);++i<o;)a[i]=t(e[i],i,e);else a=[],cr(e,function(e,n,r){a[++i]=t(e,n,r)});return a}function en(e,t,r){var i=-(1/0),o=i;if("function"!=typeof t&&r&&r[t]===e&&(t=null),null==t&&Zt(e))for(var u=-1,c=e.length;++u<c;){var l=e[u];l>o&&(o=l)}else t=null==t&&Ae(e)?a:n.createCallback(t,r,3),Je(e,function(e,n,r){var a=t(e,n,r);a>i&&(i=a,o=e)});return o}function nn(e,t,r){var i=1/0,o=i;if("function"!=typeof t&&r&&r[t]===e&&(t=null),null==t&&Zt(e))for(var u=-1,c=e.length;++u<c;){var l=e[u];o>l&&(o=l)}else t=null==t&&Ae(e)?a:n.createCallback(t,r,3),Je(e,function(e,n,r){var a=t(e,n,r);i>a&&(i=a,o=e)});return o}function tn(e,t,r,i){if(!e)return r;var o=arguments.length<3;t=n.createCallback(t,i,4);var a=-1,u=e.length;if("number"==typeof u)for(o&&(r=e[++a]);++a<u;)r=t(r,e[a],a,e);else cr(e,function(e,n,i){r=o?(o=!1,e):t(r,e,n,i)});return r}function rn(e,t,r,i){var o=arguments.length<3;return t=n.createCallback(t,i,4),Xe(e,function(e,n,i){r=o?(o=!1,e):t(r,e,n,i)}),r}function on(e,t,r){return t=n.createCallback(t,r,3),Ve(e,function(e,n,r){return!t(e,n,r)})}function an(e,n,t){if(e&&"number"!=typeof e.length&&(e=We(e)),null==n||t)return e?e[re(0,e.length-1)]:m;var r=un(e);return r.length=$t(Bt(0,n),r.length),r}function un(e){var n=-1,t=e?e.length:0,r=ht("number"==typeof t?t:0);return Je(e,function(e){var t=re(0,++n);r[n]=r[t],r[t]=e}),r}function cn(e){var n=e?e.length:0;return"number"==typeof n?n:er(e).length}function ln(e,t,r){var i;t=n.createCallback(t,r,3);var o=-1,a=e?e.length:0;if("number"==typeof a)for(;++o<a&&!(i=t(e[o],o,e)););else cr(e,function(e,n,r){return!(i=t(e,n,r))});return!!i}function fn(e,t,r){var i=-1,o=Zt(t),a=e?e.length:0,c=ht("number"==typeof a?a:0);for(o||(t=n.createCallback(t,r,3)),Je(e,function(e,n,r){var a=c[++i]=s();o?a.criteria=Qe(t,function(n){return e[n]}):(a.criteria=f())[0]=t(e,n,r),a.index=i,a.value=e}),a=c.length,c.sort(u);a--;){var l=c[a];c[a]=l.value,o||p(l.criteria),d(l)}return c}function sn(e){return e&&"number"==typeof e.length?h(e):We(e)}function pn(e){for(var n=-1,t=e?e.length:0,r=[];++n<t;){var i=e[n];i&&r.push(i)}return r}function dn(e){return Z(e,Q(arguments,!0,!0,1))}function hn(e,t,r){var i=-1,o=e?e.length:0;for(t=n.createCallback(t,r,3);++i<o;)if(t(e[i],i,e))return i;return-1}function vn(e,t,r){var i=e?e.length:0;for(t=n.createCallback(t,r,3);i--;)if(t(e[i],i,e))return i;return-1}function mn(e,t,r){var i=0,o=e?e.length:0;if("number"!=typeof t&&null!=t){var a=-1;for(t=n.createCallback(t,r,3);++a<o&&t(e[a],a,e);)i++}else if(i=t,null==i||r)return e?e[0]:m;return h(e,0,$t(Bt(0,i),o))}function gn(e,n,t,r){return"boolean"!=typeof n&&null!=n&&(r=t,t="function"!=typeof n&&r&&r[n]===e?null:n,n=!1),null!=t&&(e=Qe(e,t,r)),Q(e,n)}function yn(e,n,t){if("number"==typeof t){var i=e?e.length:0;t=0>t?Bt(0,i+t):t||0}else if(t){var o=Rn(e,n);return e[o]===n?o:-1}return r(e,n,t)}function bn(e,t,r){var i=0,o=e?e.length:0;if("number"!=typeof t&&null!=t){var a=o;for(t=n.createCallback(t,r,3);a--&&t(e[a],a,e);)i++}else i=null==t||r?1:t||i;return h(e,0,$t(Bt(0,o-i),o))}function wn(){for(var e=[],n=-1,t=arguments.length,o=f(),a=ce(),u=a===r,l=f();++n<t;){var s=arguments[n];(Zt(s)||pe(s))&&(e.push(s),o.push(u&&s.length>=_&&c(n?e[n]:l)))}var h=e[0],v=-1,m=h?h.length:0,g=[];e:for(;++v<m;){var y=o[0];if(s=h[v],(y?i(y,s):a(l,s))<0){for(n=t,(y||l).push(s);--n;)if(y=o[n],(y?i(y,s):a(e[n],s))<0)continue e;g.push(s)}}for(;t--;)y=o[t],y&&d(y);return p(o),p(l),g}function _n(e,t,r){var i=0,o=e?e.length:0;if("number"!=typeof t&&null!=t){var a=o;for(t=n.createCallback(t,r,3);a--&&t(e[a],a,e);)i++}else if(i=t,null==i||r)return e?e[o-1]:m;return h(e,Bt(0,o-i))}function xn(e,n,t){var r=e?e.length:0;for("number"==typeof t&&(r=(0>t?Bt(0,r+t):$t(t,r-1))+1);r--;)if(e[r]===n)return r;return-1}function Tn(e){for(var n=arguments,t=0,r=n.length,i=e?e.length:0;++t<r;)for(var o=-1,a=n[t];++o<i;)e[o]===a&&(Ft.call(e,o--,1),i--);return e}function En(e,n,t){e=+e||0,t="number"==typeof t?t:+t||1,null==n&&(n=e,e=0);for(var r=-1,i=Bt(0,kt((n-e)/(t||1))),o=ht(i);++r<i;)o[r]=e,e+=t;return o}function Mn(e,t,r){var i=-1,o=e?e.length:0,a=[];for(t=n.createCallback(t,r,3);++i<o;){var u=e[i];t(u,i,e)&&(a.push(u),Ft.call(e,i--,1),o--)}return a}function On(e,t,r){if("number"!=typeof t&&null!=t){var i=0,o=-1,a=e?e.length:0;for(t=n.createCallback(t,r,3);++o<a&&t(e[o],o,e);)i++}else i=null==t||r?1:Bt(0,t);return h(e,i)}function Rn(e,t,r,i){var o=0,a=e?e.length:o;for(r=r?n.createCallback(r,i,1):Zn,t=r(t);a>o;){var u=o+a>>>1;r(e[u])<t?o=u+1:a=u}return o}function jn(){return ie(Q(arguments,!0,!0))}function kn(e,t,r,i){return"boolean"!=typeof t&&null!=t&&(i=r,r="function"!=typeof t&&i&&i[t]===e?null:t,t=!1),null!=r&&(r=n.createCallback(r,i,3)),ie(e,t,r)}function Sn(e){return Z(e,h(arguments,1))}function Pn(){for(var e=-1,n=arguments.length;++e<n;){var t=arguments[e];if(Zt(t)||pe(t))var r=r?ie(Z(r,t).concat(Z(t,r))):t}return r||[]}function Hn(){for(var e=arguments.length>1?arguments:arguments[0],n=-1,t=e?en(dr(e,"length")):0,r=ht(0>t?0:t);++n<t;)r[n]=dr(e,n);return r}function Cn(e,n){var t=-1,r=e?e.length:0,i={};for(n||!r||Zt(e[0])||(n=[]);++t<r;){var o=e[t];n?i[o]=n[t]:o&&(i[o[0]]=o[1])}return i}function Ln(e,n){if(!ke(n))throw new Tt;return function(){return--e<1?n.apply(this,arguments):void 0}}function An(e,n){return arguments.length>2?ae(e,17,h(arguments,2),null,n):ae(e,1,null,null,n)}function zn(e){for(var n=arguments.length>1?Q(arguments,!0,!1,1):we(e),t=-1,r=n.length;++t<r;){var i=n[t];e[i]=ae(e[i],1,null,null,e)}return e}function Fn(e,n){return arguments.length>2?ae(n,19,h(arguments,2),null,e):ae(n,3,null,null,e)}function Dn(){for(var e=arguments,n=e.length;n--;)if(!ke(e[n]))throw new Tt;return function(){for(var n=arguments,t=e.length;t--;)n=[e[t].apply(this,n)];return n[0]}}function In(e,n){return n="number"==typeof n?n:+n||e.length,ae(e,4,null,null,null,n)}function qn(e,n,t){var r,i,o,a,u,c,l,f=0,s=!1,p=!0;if(!ke(e))throw new Tt;if(n=Bt(0,n)||0,t===!0){var d=!0;p=!1}else Se(t)&&(d=t.leading,s="maxWait"in t&&(Bt(n,t.maxWait)||0),p="trailing"in t?t.trailing:p);var h=function(){var t=n-(vr()-a);if(0>=t){i&&St(i);var s=l;i=c=l=m,s&&(f=vr(),o=e.apply(u,r),c||i||(r=u=null))}else c=zt(h,t)},v=function(){c&&St(c),i=c=l=m,(p||s!==n)&&(f=vr(),o=e.apply(u,r),c||i||(r=u=null))};return function(){if(r=arguments,a=vr(),u=this,l=p&&(c||!d),s===!1)var t=d&&!c;else{i||d||(f=a);var m=s-(a-f),g=0>=m;g?(i&&(i=St(i)),f=a,o=e.apply(u,r)):i||(i=zt(v,m))}return g&&c?c=St(c):c||n===s||(c=zt(h,n)),t&&(g=!0,o=e.apply(u,r)),!g||c||i||(r=u=null),o}}function Un(e){if(!ke(e))throw new Tt;var n=h(arguments,1);return zt(function(){e.apply(m,n)},1)}function Gn(e,n){if(!ke(e))throw new Tt;var t=h(arguments,2);return zt(function(){e.apply(m,t)},n)}function Wn(e,n){if(!ke(e))throw new Tt;var t=function(){var r=t.cache,i=n?n.apply(this,arguments):w+arguments[0];return Lt.call(r,i)?r[i]:r[i]=e.apply(this,arguments)};return t.cache={},t}function Nn(e){var n,t;if(!ke(e))throw new Tt;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}}function Bn(e){return ae(e,16,h(arguments,1))}function $n(e){return ae(e,32,null,h(arguments,1))}function Vn(e,n,t){var r=!0,i=!0;if(!ke(e))throw new Tt;return t===!1?r=!1:Se(t)&&(r="leading"in t?t.leading:r,i="trailing"in t?t.trailing:i),V.leading=r,V.maxWait=n,V.trailing=i,qn(e,n,V)}function Yn(e,n){return ae(n,16,[e])}function Kn(e){return function(){return e}}function Jn(e,n,t){var r=typeof e;if(null==e||"function"==r)return x(e,n,t);if("object"!=r)return tt(e);var i=er(e),o=i[0],a=e[o];return 1!=i.length||a!==a||Se(a)?function(n){for(var t=i.length,r=!1;t--&&(r=ee(n[i[t]],e[i[t]],null,!0)););return r}:function(e){var n=e[o];return a===n&&(0!==a||1/a==1/n)}}function Xn(e){return null==e?"":xt(e).replace(ir,ue)}function Zn(e){return e}function Qn(e,r,i){var o=!0,a=r&&we(r);r&&(i||a.length)||(null==i&&(i=r),u=t,r=e,e=n,a=we(r)),i===!1?o=!1:Se(i)&&"chain"in i&&(o=i.chain);var u=e,c=ke(u);Je(a,function(n){var t=e[n]=r[n];c&&(u.prototype[n]=function(){var n=this.__chain__,r=this.__wrapped__,i=[r];At.apply(i,arguments);var a=t.apply(e,i);if(o||n){if(r===a&&Se(a))return this;a=new u(a),a.__chain__=n}return a})})}function et(){return e._=Ot,this}function nt(){}function tt(e){return function(n){return n[e]}}function rt(e,n,t){var r=null==e,i=null==n;if(null==t&&("boolean"==typeof e&&i?(t=e,e=1):i||"boolean"!=typeof n||(t=n,i=!0)),r&&i&&(n=1),e=+e||0,i?(n=e,e=0):n=+n||0,t||e%1||n%1){var o=Yt();return $t(e+o*(n-e+parseFloat("1e-"+((o+"").length-1))),n)}return re(e,n)}function it(e,n){if(e){var t=e[n];return ke(t)?e[n]():t}}function ot(e,t,r){var i=n.templateSettings;e=xt(e||""),r=ar({},r,i);var o,a=ar({},r.imports,i.imports),u=er(a),c=We(a),f=0,s=r.interpolate||H,p="__p += '",d=_t((r.escape||H).source+"|"+s.source+"|"+(s===S?R:H).source+"|"+(r.evaluate||H).source+"|$","g");e.replace(d,function(n,t,r,i,a,u){return r||(r=i),p+=e.slice(f,u).replace(L,l),t&&(p+="' +\n__e("+t+") +\n'"),a&&(o=!0,p+="';\n"+a+";\n__p += '"),r&&(p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),f=u+n.length,n}),p+="';\n";var h=r.variable,v=h;v||(h="obj",p="with ("+h+") {\n"+p+"\n}\n"),p=(o?p.replace(E,""):p).replace(M,"$1").replace(O,"$1;"),p="function("+h+") {\n"+(v?"":h+" || ("+h+" = {});\n")+"var __t, __p = '', __e = _.escape"+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var g="\n/*\n//# sourceURL="+(r.sourceURL||"/lodash/template/source["+z++ +"]")+"\n*/";try{var y=gt(u,"return "+p+g).apply(m,c)}catch(b){throw b.source=p,b}return t?y(t):(y.source=p,y)}function at(e,n,t){e=(e=+e)>-1?e:0;var r=-1,i=ht(e);for(n=x(n,t,1);++r<e;)i[r]=n(r);return i}function ut(e){return null==e?"":xt(e).replace(rr,se)}function ct(e){var n=++b;return xt(null==e?"":e)+n}function lt(e){return e=new t(e),e.__chain__=!0,e}function ft(e,n){return n(e),e}function st(){return this.__chain__=!0,this}function pt(){return xt(this.__wrapped__)}function dt(){return this.__wrapped__}e=e?te.defaults(X.Object(),e,te.pick(X,A)):X;var ht=e.Array,vt=e.Boolean,mt=e.Date,gt=e.Function,yt=e.Math,bt=e.Number,wt=e.Object,_t=e.RegExp,xt=e.String,Tt=e.TypeError,Et=[],Mt=wt.prototype,Ot=e._,Rt=Mt.toString,jt=_t("^"+xt(Rt).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),kt=yt.ceil,St=e.clearTimeout,Pt=yt.floor,Ht=gt.prototype.toString,Ct=le(Ct=wt.getPrototypeOf)&&Ct,Lt=Mt.hasOwnProperty,At=Et.push,zt=e.setTimeout,Ft=Et.splice,Dt=Et.unshift,It=function(){try{var e={},n=le(n=wt.defineProperty)&&n,t=n(e,e,e)&&n}catch(r){}return t}(),qt=le(qt=wt.create)&&qt,Ut=le(Ut=ht.isArray)&&Ut,Gt=e.isFinite,Wt=e.isNaN,Nt=le(Nt=wt.keys)&&Nt,Bt=yt.max,$t=yt.min,Vt=e.parseInt,Yt=yt.random,Kt={};Kt[D]=ht,Kt[I]=vt,Kt[q]=mt,Kt[U]=gt,Kt[W]=wt,Kt[G]=bt,Kt[N]=_t,Kt[B]=xt,t.prototype=n.prototype;var Jt=n.support={};Jt.funcDecomp=!le(e.WinRTError)&&C.test(v),Jt.funcNames="string"==typeof gt.name,n.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:S,variable:"",imports:{_:n}},qt||(y=function(){function n(){}return function(t){if(Se(t)){n.prototype=t;var r=new n;n.prototype=null}return r||e.Object()}}());var Xt=It?function(e,n){Y.value=n,It(e,"__bindData__",Y),Y.value=null}:nt,Zt=Ut||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Rt.call(e)==D||!1},Qt=function(e){var n,t=e,r=[];if(!t)return r;if(!K[typeof e])return r;for(n in t)Lt.call(t,n)&&r.push(n);return r},er=Nt?function(e){return Se(e)?Nt(e):[]}:Qt,nr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},tr=xe(nr),rr=_t("("+er(tr).join("|")+")","g"),ir=_t("["+er(nr).join("")+"]","g"),or=function(e,n,t){var r,i=e,o=i;if(!i)return o;var a=arguments,u=0,c="number"==typeof t?2:a.length;if(c>3&&"function"==typeof a[c-2])var l=x(a[--c-1],a[c--],2);else c>2&&"function"==typeof a[c-1]&&(l=a[--c]);for(;++u<c;)if(i=a[u],i&&K[typeof i])for(var f=-1,s=K[typeof i]&&er(i),p=s?s.length:0;++f<p;)r=s[f],o[r]=l?l(o[r],i[r]):i[r];return o},ar=function(e,n,t){var r,i=e,o=i;if(!i)return o;for(var a=arguments,u=0,c="number"==typeof t?2:a.length;++u<c;)if(i=a[u],i&&K[typeof i])for(var l=-1,f=K[typeof i]&&er(i),s=f?f.length:0;++l<s;)r=f[l],"undefined"==typeof o[r]&&(o[r]=i[r]);return o},ur=function(e,n,t){var r,i=e,o=i;if(!i)return o;if(!K[typeof i])return o;n=n&&"undefined"==typeof t?n:x(n,t,3);for(r in i)if(n(i[r],r,e)===!1)return o;return o},cr=function(e,n,t){var r,i=e,o=i;if(!i)return o;if(!K[typeof i])return o;n=n&&"undefined"==typeof t?n:x(n,t,3);for(var a=-1,u=K[typeof i]&&er(i),c=u?u.length:0;++a<c;)if(r=u[a],n(i[r],r,e)===!1)return o;return o},lr=Ct?function(e){if(!e||Rt.call(e)!=W)return!1;var n=e.valueOf,t=le(n)&&(t=Ct(n))&&Ct(t);return t?e==t||Ct(e)==t:fe(e)}:fe,fr=oe(function(e,n,t){Lt.call(e,t)?e[t]++:e[t]=1}),sr=oe(function(e,n,t){(Lt.call(e,t)?e[t]:e[t]=[]).push(n)}),pr=oe(function(e,n,t){e[t]=n}),dr=Qe,hr=Ve,vr=le(vr=mt.now)&&vr||function(){return(new mt).getTime()},mr=8==Vt(T+"08")?Vt:function(e,n){return Vt(Ae(e)?e.replace(P,""):e,n||0)};return n.after=Ln,n.assign=or,n.at=Ne,n.bind=An,n.bindAll=zn,n.bindKey=Fn,n.chain=lt,n.compact=pn,n.compose=Dn,n.constant=Kn,n.countBy=fr,n.create=ve,n.createCallback=Jn,n.curry=In,n.debounce=qn,n.defaults=ar,n.defer=Un,n.delay=Gn,n.difference=dn,n.filter=Ve,n.flatten=gn,n.forEach=Je,n.forEachRight=Xe,n.forIn=ur,n.forInRight=ye,n.forOwn=cr,n.forOwnRight=be,n.functions=we,n.groupBy=sr,n.indexBy=pr,n.initial=bn,n.intersection=wn,n.invert=xe,n.invoke=Ze,n.keys=er,n.map=Qe,n.mapValues=Fe,n.max=en,n.memoize=Wn,n.merge=De,n.min=nn,n.omit=Ie,n.once=Nn,n.pairs=qe,n.partial=Bn,n.partialRight=$n,n.pick=Ue,n.pluck=dr,n.property=tt,n.pull=Tn,n.range=En,n.reject=on,n.remove=Mn,n.rest=On,n.shuffle=un,n.sortBy=fn,n.tap=ft,n.throttle=Vn,n.times=at,n.toArray=sn,n.transform=Ge,n.union=jn,n.uniq=kn,n.values=We,n.where=hr,n.without=Sn,n.wrap=Yn,n.xor=Pn,n.zip=Hn,n.zipObject=Cn,n.collect=Qe,n.drop=On,n.each=Je,n.eachRight=Xe,n.extend=or,n.methods=we,n.object=Cn,n.select=Ve,n.tail=On,n.unique=kn,n.unzip=Hn,Qn(n),n.clone=de,n.cloneDeep=he,n.contains=Be,n.escape=Xn,n.every=$e,n.find=Ye,n.findIndex=hn,n.findKey=me,n.findLast=Ke,n.findLastIndex=vn,n.findLastKey=ge,n.has=_e,n.identity=Zn,n.indexOf=yn,n.isArguments=pe,n.isArray=Zt,n.isBoolean=Te,n.isDate=Ee,n.isElement=Me,n.isEmpty=Oe,n.isEqual=Re,n.isFinite=je,n.isFunction=ke,n.isNaN=Pe,n.isNull=He,n.isNumber=Ce,n.isObject=Se,n.isPlainObject=lr,n.isRegExp=Le,n.isString=Ae,n.isUndefined=ze,n.lastIndexOf=xn,n.mixin=Qn,n.noConflict=et,n.noop=nt,n.now=vr,n.parseInt=mr,n.random=rt,n.reduce=tn,n.reduceRight=rn,n.result=it,n.runInContext=v,n.size=cn,n.some=ln,n.sortedIndex=Rn,n.template=ot,n.unescape=ut,n.uniqueId=ct,n.all=$e,n.any=ln,n.detect=Ye,n.findWhere=Ye,n.foldl=tn,n.foldr=rn,n.include=Be,n.inject=tn,Qn(function(){var e={};return cr(n,function(t,r){n.prototype[r]||(e[r]=t)}),e}(),!1),n.first=mn,n.last=_n,n.sample=an,n.take=mn,n.head=mn,cr(n,function(e,r){var i="sample"!==r;n.prototype[r]||(n.prototype[r]=function(n,r){var o=this.__chain__,a=e(this.__wrapped__,n,r);return o||null!=n&&(!r||i&&"function"==typeof n)?new t(a,o):a})}),n.VERSION="2.4.2",n.prototype.chain=st,n.prototype.toString=pt,n.prototype.value=dt,n.prototype.valueOf=dt,Je(["join","pop","shift"],function(e){var r=Et[e];n.prototype[e]=function(){var e=this.__chain__,n=r.apply(this.__wrapped__,arguments);return e?new t(n,e):n}}),Je(["push","reverse","sort","unshift"],function(e){var t=Et[e];n.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),Je(["concat","slice","splice"],function(e){var r=Et[e];n.prototype[e]=function(){return new t(r.apply(this.__wrapped__,arguments),this.__chain__)}}),n}var m,g=[],y=[],b=0,w=+new Date+"",_=75,x=40,T=" 	\x0B\f \ufeff\n\r\u2028\u2029 ᠎             　",E=/\b__p \+= '';/g,M=/\b(__p \+=) '' \+/g,O=/(__e\(.*?\)|\b__t\)) \+\n'';/g,R=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,j=/\w*$/,k=/^\s*function[ \n\r\t]+\w/,S=/<%=([\s\S]+?)%>/g,P=RegExp("^["+T+"]*0+(?=.$)"),H=/($^)/,C=/\bthis\b/,L=/['\n\r\t\u2028\u2029\\]/g,A=["Array","Boolean","Date","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],z=0,F="[object Arguments]",D="[object Array]",I="[object Boolean]",q="[object Date]",U="[object Function]",G="[object Number]",W="[object Object]",N="[object RegExp]",B="[object String]",$={};$[U]=!1,$[F]=$[D]=$[I]=$[q]=$[G]=$[W]=$[N]=$[B]=!0;var V={leading:!1,maxWait:0,trailing:!1},Y={configurable:!1,enumerable:!1,value:null,writable:!1},K={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},J={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},X=K[typeof window]&&window||this,Z=K[typeof t]&&t&&!t.nodeType&&t,Q=K[typeof n]&&n&&!n.nodeType&&n,ee=Q&&Q.exports===Z&&Z,ne=K[typeof e]&&e;!ne||ne.global!==ne&&ne.window!==ne||(X=ne);var te=v();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(X._=te,define(function(){return te})):Z&&Q?ee?(Q.exports=te)._=te:Z._=te:X._=te}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,n,t){function r(){f=!1,u.length?l=u.concat(l):s=-1,l.length&&i()}function i(){if(!f){var e=setTimeout(r);f=!0;for(var n=l.length;n;){for(u=l,l=[];++s<n;)u&&u[s].run();s=-1,n=l.length}u=null,f=!1,clearTimeout(e)}}function o(e,n){this.fun=e,this.array=n}function a(){}var u,c=n.exports={},l=[],f=!1,s=-1;c.nextTick=function(e){var n=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)n[t-1]=arguments[t];l.push(new o(e,n)),1!==l.length||f||setTimeout(i,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=a,c.addListener=a,c.once=a,c.off=a,c.removeListener=a,c.removeAllListeners=a,c.emit=a,c.binding=function(e){throw new Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw new Error("process.chdir is not supported")},c.umask=function(){return 0}},{}],4:[function(e,n,t){"use strict";n.exports=e("./lib/core.js"),e("./lib/done.js"),e("./lib/es6-extensions.js"),e("./lib/node-extensions.js")},{"./lib/core.js":5,"./lib/done.js":6,"./lib/es6-extensions.js":7,"./lib/node-extensions.js":8}],5:[function(e,n,t){"use strict";function r(e){function n(e){return null===c?void f.push(e):void a(function(){var n=c?e.onFulfilled:e.onRejected;if(null===n)return void(c?e.resolve:e.reject)(l);var t;try{t=n(l)}catch(r){return void e.reject(r)}e.resolve(t)})}function t(e){try{if(e===s)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void o(n.bind(e),t,r)}c=!0,l=e,u()}catch(i){r(i)}}function r(e){c=!1,l=e,u()}function u(){for(var e=0,t=f.length;t>e;e++)n(f[e]);f=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");var c=null,l=null,f=[],s=this;this.then=function(e,t){return new s.constructor(function(r,o){n(new i(e,t,r,o))})},o(e,t,r)}function i(e,n,t,r){this.onFulfilled="function"==typeof e?e:null,
this.onRejected="function"==typeof n?n:null,this.resolve=t,this.reject=r}function o(e,n,t){var r=!1;try{e(function(e){r||(r=!0,n(e))},function(e){r||(r=!0,t(e))})}catch(i){if(r)return;r=!0,t(i)}}var a=e("asap");n.exports=r},{asap:1}],6:[function(e,n,t){"use strict";var r=e("./core.js"),i=e("asap");n.exports=r,r.prototype.done=function(e,n){var t=arguments.length?this.then.apply(this,arguments):this;t.then(null,function(e){i(function(){throw e})})}},{"./core.js":5,asap:1}],7:[function(e,n,t){"use strict";function r(e){this.then=function(n){return"function"!=typeof n?this:new i(function(t,r){o(function(){try{t(n(e))}catch(i){r(i)}})})}}var i=e("./core.js"),o=e("asap");n.exports=i,r.prototype=i.prototype;var a=new r(!0),u=new r(!1),c=new r(null),l=new r(void 0),f=new r(0),s=new r("");i.resolve=function(e){if(e instanceof i)return e;if(null===e)return c;if(void 0===e)return l;if(e===!0)return a;if(e===!1)return u;if(0===e)return f;if(""===e)return s;if("object"==typeof e||"function"==typeof e)try{var n=e.then;if("function"==typeof n)return new i(n.bind(e))}catch(t){return new i(function(e,n){n(t)})}return new r(e)},i.all=function(e){var n=Array.prototype.slice.call(e);return new i(function(e,t){function r(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var u=a.then;if("function"==typeof u)return void u.call(a,function(e){r(o,e)},t)}n[o]=a,0===--i&&e(n)}catch(c){t(c)}}if(0===n.length)return e([]);for(var i=n.length,o=0;o<n.length;o++)r(o,n[o])})},i.reject=function(e){return new i(function(n,t){t(e)})},i.race=function(e){return new i(function(n,t){e.forEach(function(e){i.resolve(e).then(n,t)})})},i.prototype["catch"]=function(e){return this.then(null,e)}},{"./core.js":5,asap:1}],8:[function(e,n,t){"use strict";var r=e("./core.js"),i=e("asap");n.exports=r,r.denodeify=function(e,n){return n=n||1/0,function(){var t=this,i=Array.prototype.slice.call(arguments);return new r(function(r,o){for(;i.length&&i.length>n;)i.pop();i.push(function(e,n){e?o(e):r(n)});var a=e.apply(t,i);!a||"object"!=typeof a&&"function"!=typeof a||"function"!=typeof a.then||r(a)})}},r.nodeify=function(e){return function(){var n=Array.prototype.slice.call(arguments),t="function"==typeof n[n.length-1]?n.pop():null,o=this;try{return e.apply(this,arguments).nodeify(t,o)}catch(a){if(null===t||"undefined"==typeof t)return new r(function(e,n){n(a)});i(function(){t.call(o,a)})}}},r.prototype.nodeify=function(e,n){return"function"!=typeof e?this:void this.then(function(t){i(function(){e.call(n,null,t)})},function(t){i(function(){e.call(n,t)})})}},{"./core.js":5,asap:1}],9:[function(e,n,t){"use strict";var r=function(){function e(e,n){var t=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(t.push(a.value),!n||t.length!==n);r=!0);}catch(c){i=!0,o=c}finally{try{!r&&u["return"]&&u["return"]()}finally{if(i)throw o}}return t}return function(n,t){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=e("lodash"),o=e("./utils"),a="https://endgame-chess.firebaseio.com",u=8,c=["white","black"],l=["1","2","3","4","5","6","7","8"],f=["a","b","c","d","e","f","g","h"],s=["rook","knight","bishop","queen","king","bishop","knight","rook"],p=function(e){var n=r(e,2),t=n[0],i=n[1];return{pos:t.join(""),type:i}},d=function(e,n){return i.map(i.zip(i.zip(f,o.repeat(e,u)),n),p)};n.exports={dbBaseUrl:a,usersUrl:a+"/users",gamesUrl:a+"/games",peerJsKey:"e47332e9vb4yrpb9",iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"stun:stun1.l.google.com:19302"},{url:"stun:stun2.l.google.com:19302"},{url:"stun:stun3.l.google.com:19302"},{url:"stun:stun4.l.google.com:19302"}],localMediaWidth:240,mediaWidth:320,mediaHeight:240,mediaMinFrameRate:10,pieces:["pawn","knight","bishop","rook","queen","king"],assets:["board"],sides:c,ranks:l,files:f,startPosition:{white:d("2",o.repeat("pawn",u)).concat(d("1",s)),black:d("7",o.repeat("pawn",u)).concat(d("8",s))},rankToOffset:i.zipObject(l,i.range(u)),fileToOffset:i.zipObject(f,i.range(u)),gameOpts:{boardScale:4.7,boardStartOffset:16.5,tileSize:4.7,tileOpacity:.4,pieceYOffset:1.7,cameraStartPos:{x:30,y:15,z:30},cameraPlayPos:{x:0,y:22,z:45},cameraPlayLookAt:{x:0,y:5,z:0},friendScreenSize:{x:30,y:20,z:5},friendScreenPos:{x:0,y:10,z:-30}},colors:{pieces:{white:{color:14540253,ambient:16777215,emissive:0,specular:11184810},black:{color:2236962,ambient:0,emissive:0,specular:1118481}},tiles:{active:16753920,legal:8044866,selected:3832473,prevFrom:6475007,prevTo:14297120},clear:"lightgray",friendScreen:14342874}}},{"./utils":19,lodash:2}],10:[function(e,n,t){(function(n){"use strict";e("./polyfills");var t=e("promise"),r=(e("lodash"),e("./user"),e("./game")),i=e("./media"),o=e("./routes"),a=e("./rtc"),u=e("./scene"),c=e("./config"),l=(e("./utils"),e("./views")),f=e("./log"),s={config:c,main:function(){var e=this;u.init(),u.loadGameGeometry().then(u.setupBoard.bind(u)).done(),u.beginRender();var n=o.parseGameId();n?(e.isHost=!1,e.connectToGame(n)):(e.isHost=!0,e.setupGame())},setupGame:function(){var e=this;e.side="white",a.init().then(r.create.bind(r)).then(l.showWaitScreen.bind(l)).then(a.listen.bind(a)).then(e.setupMedia.bind(e)).then(e.performMediaCalls.bind(e)).then(e.displayRemoteMedia.bind(e)).then(e.beginGame.bind(e)).done()},connectToGame:function(e){var n=this;n.side="black",a.init().then(r.join.bind(r,e)).then(a.connect.bind(a)).then(n.setupMedia.bind(n)).then(n.performMediaCalls.bind(n)).then(n.displayRemoteMedia.bind(n)).then(n.beginGame.bind(n)).done()},setupMedia:function(){f("setting up the media");var e=this;return l.showMediaScreen().then(function(){return t.all([new t(function(n,t){a.addDataListener(function(t,r){"mediarequestcomplete"===t.event?(e.remoteHasMedia=t.hasMedia,f("remote media request complete:",e.remoteHasMedia),n()):f("ERROR: unknown event type",t.event)},!0)}),i.init().then(function(){e.localHasMedia=!0,f("local media granted"),i.playLocalStream(),a.sendData({event:"mediarequestcomplete",hasMedia:!0})},function(){e.localHasMedia=!1,f("local media denied"),a.sendData({event:"mediarequestcomplete",hasMedia:!1})})])})},performMediaCalls:function(){f("performing remote media calls");var e=this;if(!e.localHasMedia&&!e.remoteHasMedia)return t.resolve();var n=e.isHost&&e.localHasMedia||!e.isHost&&!e.remoteHasMedia&&e.localHasMedia;return a.performMediaCall(n,e.localHasMedia&&i.localMediaStream)},displayRemoteMedia:function(e){var n=this;return new t(function(t,r){n.remoteHasMedia?e.on("stream",function(e){var r=i.configureRemoteStream(e);u.addFriendScreen(n.side,r),t()}):(u.addFriendScreen(n.side),t())})},beginGame:function(){f("commencing game");var e=this;l.showStatusScreen().then(function(){return new t(function(n,t){e.chess=new Chess,e.isMyTurn="white"===e.side,u.addTileControls(function(n){return e.chess.moves({square:n,verbose:!0})},function(n,t){var i=e.chess.move({from:n,to:t});i?(a.sendData({event:"chessmove",move:i}),r(i)):f("ERROR: illegal move attempted locally - bug?")});var r=function(n){e.isMyTurn=!e.isMyTurn,u.performGraphicalMove(n)};a.addDataListener(function(n,t){if("chessmove"===n.event)if(e.isMyTurn)f("ERROR: opponent attempted to move on my turn");else{var i=e.chess.move(n.move);i?r(i):f("ERROR: opponent attempted invalid move",n)}else f("ERROR: unknown event type",n.event)})})}).done()}};n.endgame=s,s.main()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./config":9,"./game":11,"./log":12,"./media":13,"./polyfills":14,"./routes":15,"./rtc":16,"./scene":17,"./user":18,"./utils":19,"./views":20,lodash:2,promise:4}],11:[function(e,n,t){"use strict";var r=e("promise"),i=e("./config");e("./log");n.exports={create:function(e){var n=this;return n.ref=new Firebase(i.gamesUrl),n.gameRef=n.ref.push(),n.gameRef.set({hostId:e}),r.resolve(n.gameRef.key())},join:function(e){var n=this;return n.ref=new Firebase(i.gamesUrl),n.gameRef=n.ref.child(e),new r(function(e,t){n.gameRef.once("value",function(n){e(n.val().hostId)})})}}},{"./config":9,"./log":12,promise:4}],12:[function(e,n,t){(function(e){"use strict";var t=!0;n.exports=function(){e.console&&t&&console.log.apply(console,Array.prototype.slice.call(arguments))}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],13:[function(e,n,t){"use strict";var r=e("promise"),i=e("./config");e("./log");n.exports={init:function(){var e=this;return new r(function(n,t){return navigator.getUserMedia?void navigator.getUserMedia({video:{mandatory:{maxWidth:i.mediaWidth,maxHeight:i.mediaHeight,minFrameRate:i.mediaMinFrameRate}},audio:!0},function(t){e.localMediaStream=t,n(t)},t):t()})},playLocalStream:function(){var e=this,n=$("#localvideo").get(0);e.playStream(e.localMediaStream,n);var t=!1;n.addEventListener("canplay",function(e){t||!n.videoHeight&&!n.videoWidth||(t=!0,n.width=i.localMediaWidth,n.height=n.videoHeight/(n.videoWidth/i.localMediaWidth),$("#localvideopanel").show("slow"))},!1)},configureRemoteStream:function(e){var n=this;n.remoteMediaStream=e;var t=document.createElement("video");return n.playStream(e,t),t},playStream:function(e,n){n.autoplay=!0,navigator.mozGetUserMedia?n.mozSrcObject=e:n.src=window.URL.createObjectURL(e)}}},{"./config":9,"./log":12,promise:4}],14:[function(e,n,t){"use strict";!function(){for(var e=0,n=["webkit","moz"],t=0;t<n.length&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[n[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[t]+"CancelAnimationFrame"]||window[n[t]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(n,t){var r=(new Date).getTime(),i=Math.max(0,16-(r-e)),o=window.setTimeout(function(){n(r+i)},i);return e=r+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}(),function(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}(),function(){window.URL=window.URL||window.webkitURL}()},{}],15:[function(e,n,t){"use strict";var r=e("lodash"),i=e("./utils");n.exports={parseGameId:function(){return r.last(i.pathParts(window.location.pathname))||window.location.hash.substring(1)},genGameUrl:function(e){var n=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),t="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"#":"";return n+"/"+t+e}}},{"./utils":19,lodash:2}],16:[function(e,n,t){"use strict";var r=e("promise"),i=e("lodash"),o=e("./config");n.exports={init:function(){var e=this;return e.peer=new Peer({key:o.peerJsKey,config:{iceServers:o.iceServers}}),new r(function(n,t){e.peer.on("open",n)})},listen:function(){var e=this;return new r(function(n,t){e.peer.on("connection",function(t){e.conn=t,e.remoteId=t.peer,e.setupDataBus(t),n(t)})})},connect:function(e){var n=this,t=n.peer.connect(e,{reliable:!0});return n.conn=t,n.remoteId=t.peer,n.setupDataBus(t),r.resolve(t)},setupDataBus:function(e){var n=this;n.queuedData=[],n.listeners=[],e.on("open",function(){e.on("data",function(t){var r=n.listeners.slice();i.forEach(r,function(r){if(r.fn.call(n,t,e),r.once){var i=n.listeners.indexOf(r);-1!==i&&n.listeners.splice(i,1)}})}),i.forEach(n.queuedData,function(e){n.conn.send(e)})})},addDataListener:function(e,n){var t=this;t.listeners.push({fn:e,once:n})},sendData:function(e){var n=this;n.conn.open?n.conn.send(e):n.queuedData.push(e)},performMediaCall:function(e,n){var t=this;return new r(function(r,i){e?(t.call=t.peer.call(t.remoteId,n),r(t.call)):t.peer.on("call",function(e){t.call=e,n&&e.answer(n),r(t.call)})})}}},{"./config":9,lodash:2,promise:4}],17:[function(e,n,t){"use strict";var r=e("promise"),i=e("lodash"),o=e("./config"),a=e("./log");n.exports={init:function(){var e=this;e.scene=new THREE.Scene,e.camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,.1,1e3),e.renderer=e.createRenderer(),e.renderer.setClearColor(new THREE.Color(o.colors.clear),1),e.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(e.renderer.domElement),window.addEventListener("resize",e.resize.bind(e),!1),e.addLighting(),e.setInitialCameraPos()},resize:function(){var e=this;e.camera.aspect=window.innerWidth/window.innerHeight,e.camera.updateProjectionMatrix(),e.renderer.setSize(window.innerWidth,window.innerHeight)},createRenderer:function(){var e=this,n=e.webglAvailable()?new THREE.WebGLRenderer({antialias:!0}):new THREE.CanvasRenderer;return n},webglAvailable:function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(n){return!1}},addLighting:function(){var e=this;e.dirLight=new THREE.DirectionalLight(16777215,.9),e.dirLight.position.set(0,80,0).normalize(),e.scene.add(e.dirLight),e.hemiLight=new THREE.HemisphereLight(16777215,16777215,.2),e.scene.add(e.hemiLight)},setInitialCameraPos:function(){var e=this;e.camera.position.x=o.gameOpts.cameraStartPos.x,e.camera.position.y=o.gameOpts.cameraStartPos.y,e.camera.position.z=o.gameOpts.cameraStartPos.z,e.camera.lookAt(new THREE.Vector3(0,0,0))},setPlayCameraPos:function(e){var n=this;n.camera.position.x=o.gameOpts.cameraPlayPos.x,n.camera.position.y=o.gameOpts.cameraPlayPos.y,n.camera.position.z=("black"===e?-1:1)*o.gameOpts.cameraPlayPos.z,n.camera.lookAt(new THREE.Vector3(o.gameOpts.cameraPlayLookAt.x,o.gameOpts.cameraPlayLookAt.y,o.gameOpts.cameraPlayLookAt.z))},loadGameGeometry:function(){var e=this;return e.meshes={},r.all(i.map(o.pieces.concat(o.assets),function(n){return new r(function(t,r){var u=new THREE.JSONLoader;u.load("data/"+n+".json",function(r,u){var c=u[0];if(i.contains(o.assets,n)){var l=new THREE.Mesh(r,c);e.meshes[n]=l}else r.computeFaceNormals(),r.computeVertexNormals(),i.forEach(o.sides,function(t){var i=c.clone();i.color.setHex(o.colors.pieces[t].color),i.ambient.setHex(o.colors.pieces[t].ambient),i.emissive.setHex(o.colors.pieces[t].emissive),i.specular.setHex(o.colors.pieces[t].specular);var a=new THREE.Mesh(r,i);e.meshes[t]||(e.meshes[t]={}),e.meshes[t][n]=a});a("done loading",n),t()})})}))},setupBoard:function(){var e=this;e.addSkybox(),e.addBoard(),e.addPieces()},addSkybox:function(){var e=new THREE.MeshLambertMaterial({color:14342874,depthWrite:!1,side:THREE.BackSide}),n=new THREE.Mesh(new THREE.BoxGeometry(150,100,200),e);n.position.set(0,50,0)},addBoard:function(){var e=this;e.board=new THREE.Object3D,e.board.add(e.meshes.board),e.board.scale.set(o.gameOpts.boardScale,o.gameOpts.boardScale,o.gameOpts.boardScale),e.scene.add(e.board)},addPieces:function(){var e=this;e.pieces={},e.captured={w:[],b:[]},i.forEach(o.startPosition,function(n,t){i.forEach(n,function(n,r){e.addPiece(n.pos,n.type,t)})})},addPiece:function(e,n,t){a("creating",n,t);var r=this,i=new THREE.Object3D;i.add(r.meshes[t][n].clone()),i.position.setY(o.gameOpts.pieceYOffset),r.setPiecePosition(i,e),"white"===t&&(i.rotation.y=Math.PI),r.scene.add(i),r.pieces[e]={type:n,side:t,object:i}},addFriendScreen:function(e,n){var t=this,r=void 0;n?(t.friendVideo=n,t.friendTexture=new THREE.Texture(n),t.friendTexture.generateMipmaps=!1,r=new THREE.MeshLambertMaterial({map:t.friendTexture,emissive:15658734})):r=new THREE.MeshLambertMaterial({color:0});var i=new THREE.MeshLambertMaterial({color:o.colors.friendScreen}),a=[i,i,i,i,r,i],u=new THREE.BoxGeometry(o.gameOpts.friendScreenSize.x,o.gameOpts.friendScreenSize.y,o.gameOpts.friendScreenSize.z),c=new THREE.Mesh(u,new THREE.MeshFaceMaterial(a));c.position.set(o.gameOpts.friendScreenPos.x,o.gameOpts.friendScreenPos.y,o.gameOpts.friendScreenPos.z),"black"===e&&(c.position.setZ(-o.gameOpts.friendScreenPos.z),c.rotation.y=Math.PI),t.scene.add(c),t.setPlayCameraPos(e)},addTileControls:function(e,n){var t=this;t.legalCallback=e,t.moveCallback=n,t.tiles={};var r=new THREE.PlaneGeometry(o.gameOpts.tileSize,o.gameOpts.tileSize),a=new THREE.MeshLambertMaterial({color:o.colors.tiles.active,side:THREE.DoubleSide,transparent:!0,opacity:0});i.forEach(o.files,function(e,n){i.forEach(o.ranks,function(n,i){t.addTileControl(e+n,r,a.clone())})}),t.raycaster=new THREE.Raycaster,t.addMouseListeners()},addTileControl:function(e,n,t){var r=this,i=o.fileToOffset[e[0]],a=o.rankToOffset[e[1]],u=new THREE.Mesh(n,t);u.rotation.x=Math.PI/2,u.position.setY(o.gameOpts.pieceYOffset+.05),u.position.setX(-o.gameOpts.boardStartOffset+i*o.gameOpts.tileSize),u.position.setZ(o.gameOpts.boardStartOffset-a*o.gameOpts.tileSize),u.isTile=!0,u.chessPos=e,r.tiles[e]=u,r.scene.add(u)},addMouseListeners:function(){var e=this;e.mousePos=new THREE.Vector2,document.addEventListener("mousemove",e.onMouseMove.bind(e),!1),document.addEventListener("mousedown",e.onMouseDown.bind(e),!1),document.addEventListener("mouseup",e.onMouseUp.bind(e),!1)},onMouseMove:function(e){var n=this;n.updateMousePos(e),n.highlightActiveTile()},updateMousePos:function(e){var n=this;n.mousePos.x=e.clientX/window.innerWidth*2-1,n.mousePos.y=2*-(e.clientY/window.innerHeight)+1},highlightActiveTile:function(){var e=this;e.recolorTiles();var n=e.intersectTile();if(n){var t=n.object;e.colorTile(t,o.colors.tiles.active)}},onMouseDown:function(e){e.preventDefault();var n=this;n.handleMoveSelection()},handleMoveSelection:function(){var e=this,n=e.intersectTile();if(n){var t=n.object;e.isSelectingPieceMovement?t.isLegalMove?(e.commitMove(t),e.resetTileHighlights()):(e.resetTileHighlights(),e.highlightLegalMoves(t)):e.highlightLegalMoves(t)}},commitMove:function(e){var n=this;n.moveCallback.call(n,n.selectedPos,e.chessPos),n.isSelectingPieceMovement=!1,n.selectedPos=null},highlightLegalMoves:function(e){var n=this;n.isSelectingPieceMovement=!0,n.selectedPos=e.chessPos,n.colorTile(e,o.colors.tiles.selected),n.currentLegalMoves=n.legalCallback.call(n,e.chessPos),i.forEach(n.currentLegalMoves,function(e){var t=n.tiles[e.to];t.isLegalMove=!0,n.colorTile(t,o.colors.tiles.legal)})},resetTileHighlights:function(){var e=this;i.forEach(e.tiles,function(e,n){e.isLegalMove=null}),e.recolorTiles()},recolorTiles:function(){var e=this;i.forEach(e.tiles,function(n,t){e.hideTile(n),n.isLegalMove?e.colorTile(n,o.colors.tiles.legal):n.chessPos==e.selectedPos?e.colorTile(n,o.colors.tiles.selected):n.chessPos===e.prevPosFrom?e.colorTile(n,o.colors.tiles.prevFrom):n.chessPos===e.prevPosTo&&e.colorTile(n,o.colors.tiles.prevTo)})},colorTile:function(e,n){e.material.color.setHex(n),e.material.opacity=o.gameOpts.tileOpacity},hideTile:function(e){e.material.opacity=0},performGraphicalMove:function(e){var n=this,t=n.pieces[e.from];if("undefined"==typeof t)return void a("ERROR: piece not found - bug?");if(n.prevPosFrom=e.from,n.prevPosTo=e.to,-1!==e.flags.indexOf("e"),-1!==e.flags.indexOf("c")){var r=n.pieces[e.to];delete n.pieces[e.to],n.captured[e.color].push(r),n.hidePiece(r.object),delete n.pieces[e.from],n.pieces[e.to]=t,n.setPiecePosition(t.object,e.to)}-1===e.flags.indexOf("n")&&-1===e.flags.indexOf("b")||(delete n.pieces[e.from],n.pieces[e.to]=t,n.setPiecePosition(t.object,e.to)),-1!==e.flags.indexOf("p"),-1!==e.flags.indexOf("k"),-1!==e.flags.indexOf("q"),n.recolorTiles()},onMouseUp:function(e){e.preventDefault()},intersectTile:function(){var e=this;e.raycaster.setFromCamera(e.mousePos,e.camera);var n=e.raycaster.intersectObjects(e.scene.children);return i.first(i.filter(n,function(e){return e.object.isTile}))},setPiecePosition:function(e,n){var t=o.fileToOffset[n[0]],r=o.rankToOffset[n[1]];e.position.setX(-o.gameOpts.boardStartOffset+t*o.gameOpts.tileSize),e.position.setZ(o.gameOpts.boardStartOffset-r*o.gameOpts.tileSize)},hidePiece:function(e){e.visible=!1},beginRender:function(){var e=this;e.render=e.render.bind(e),e.previousTime=(new Date).getTime(),e.requestId=requestAnimationFrame(e.render)},render:function(e){var n=this;n.requestId=requestAnimationFrame(n.render);var t=(new Date).getTime();t-n.previousTime;n.previousTime=t,n.friendVideo&&n.friendVideo.readyState===n.friendVideo.HAVE_ENOUGH_DATA&&(n.friendTexture.needsUpdate=!0),n.renderer.render(n.scene,n.camera)}}},{"./config":9,"./log":12,lodash:2,promise:4}],18:[function(e,n,t){"use strict";var r=e("./config");n.exports={init:function(){var e=this;e.ref=new Firebase(r.usersUrl)}}},{"./config":9}],19:[function(e,n,t){"use strict";var r=e("lodash");n.exports={pathParts:function(e){return r.filter(e.split("/"))},repeat:function(e,n){return r.map(Array.apply(null,new Array(n)),this.identity.bind(null,e))},identity:function(e){return e}}},{lodash:2}],20:[function(e,n,t){"use strict";var r=e("promise"),i=e("./routes");e("./log");n.exports={showWaitScreen:function(e){var n=this;return n.waitScreen=new Vue({el:"#waitscreen",data:{link:i.genGameUrl(e)}}),$("#waitscreen").modal({backdrop:!1,keyboard:!1}),r.resolve()},showMediaScreen:function(){return $("#waitscreen").modal("hide"),$("#mediascreen").modal({backdrop:!1,keyboard:!1}),r.resolve()},showStatusScreen:function(){return $("#mediascreen").modal("hide"),r.resolve()}}},{"./log":12,"./routes":15,promise:4}]},{},[10]);
//# sourceMappingURL=public/endgame.min.js.map
